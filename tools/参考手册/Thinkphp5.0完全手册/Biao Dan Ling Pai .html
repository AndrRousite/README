<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-CN" xml:lang="zh-CN">
  <head>
    <title>表单令牌</title>
    <meta content="IE=edge" http-equiv="X-UA-Compatible"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="page_styles.css" rel="stylesheet" type="text/css"/>
</head>
  <body class="calibre">
        <h1 class="book-title" id="calibre_toc_177">表单令牌</h1>
<div class="book-content">
    <p class="calibre10">验证规则支持对表单的令牌验证，首先需要在你的表单里面增加下面隐藏域：</p>
<pre class="calibre21"><code class="calibre22">&lt;input type="hidden" name="__token__" value="{$Request.token}" /&gt;</code></pre>
<p class="calibre10">或者</p>
<pre class="calibre21"><code class="calibre22">{:token()}</code></pre>
<p class="calibre10">然后在你的验证规则中，添加<code class="calibre7">token</code>验证规则即可，例如，如果使用的是验证器的话，可以改为：</p>
<pre class="calibre21"><code class="calibre22">    protected $rule = [
        'name'  =&gt;  'require|max:25|token',
        'email' =&gt;  'email',
    ];</code></pre>
<p class="calibre10">如果你的令牌名称不是<code class="calibre7">__token__</code>，则表单需要改为：</p>
<pre class="calibre21"><code class="calibre22">&lt;input type="hidden" name="__hash__" value="{$Request.token.__hash__}" /&gt;</code></pre>
<p class="calibre10">或者：</p>
<pre class="calibre21"><code class="calibre22">{:token('__hash__')}</code></pre>
<p class="calibre10">验证器中需要改为：</p>
<pre class="calibre21"><code class="calibre22">    protected $rule = [
        'name'  =&gt;  'require|max:25|token:__hash__',
        'email' =&gt;  'email',
    ];</code></pre>
<p class="calibre10">如果需要自定义令牌生成规则，可以调用<code class="calibre7">Request</code>类的<code class="calibre7">token</code>方法，例如：</p>
<pre class="calibre21"><code class="calibre22">namespace app\index\controller;

use think\Controller;

class Index extends Controller
{
    public function index()
    {
        $token = $this-&gt;request-&gt;token('__token__', 'sha1');
        $this-&gt;assign('token', $token);
        return $this-&gt;fetch();
    }
}</code></pre>
<p class="calibre10">然后在模板表单中使用：</p>
<pre class="calibre21"><code class="calibre22">&lt;input type="hidden" name="__token__" value="{$token}" /&gt;</code></pre>
<p class="calibre10">或者不需要在控制器写任何代码，直接在模板中使用：</p>
<pre class="calibre21"><code class="calibre22">{:token('__token__', 'sha1')}</code></pre>
</div>
	
</body></html>
