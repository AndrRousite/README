<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-CN" xml:lang="zh-CN">
  <head>
    <title>数组访问和转换</title>
    <meta content="IE=edge" http-equiv="X-UA-Compatible"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="page_styles.css" rel="stylesheet" type="text/css"/>
</head>
  <body class="calibre">
        <h1 class="book-title" id="calibre_toc_108">数组访问和转换</h1>
<div class="book-content">
    <h2 id="%E6%95%B0%E7%BB%84%E8%AE%BF%E9%97%AE" class="calibre15">数组访问</h2>
<table class="calibre25"><thead class="calibre26"><tr class="calibre27"><th class="calibre28">版本</th>
<th class="calibre28">新增功能</th>
</tr></thead><tbody class="calibre29"><tr class="calibre27"><td class="pcalibre1 calibre30">5.0.5</td>
<td class="calibre32 pcalibre1"><code class="calibre7">hidden</code>、<code class="calibre7">visible</code>和<code class="calibre7">append</code>方法支持关联属性</td>
</tr><tr class="calibre27"><td class="pcalibre1 calibre31">5.0.4</td>
<td class="calibre33 pcalibre1">增加<code class="calibre7">appendRelationAttr</code>方法追加关联模型的属性</td>
</tr></tbody></table><p class="calibre10">模型对象支持数组方式访问，例如：</p>
<pre class="calibre21"><code class="calibre22">$user = User::find(1);
echo $user-&gt;name ; // 有效
echo $user['name'] // 同样有效
$user-&gt;name = 'thinkphp'; // 有效
$user['name'] = 'thinkphp'; // 同样有效
$user-&gt;save();</code></pre>
<h2 id="%E8%BD%AC%E6%8D%A2%E4%B8%BA%E6%95%B0%E7%BB%84" class="calibre15">转换为数组</h2>
<p class="calibre10">可以使用<code class="calibre7">toArray</code>方法将当前的模型实例输出为数组，例如：</p>
<pre class="calibre21"><code class="calibre22">$user = User::find(1);
dump($user-&gt;toArray());</code></pre>
<p class="calibre10">支持设置不输出的字段属性：</p>
<pre class="calibre21"><code class="calibre22">$user = User::find(1);
dump($user-&gt;hidden(['create_time','update_time'])-&gt;toArray());</code></pre>
<p class="calibre10">数组输出的字段值会经过获取器的处理，也可以支持追加其它获取器定义（不在数据表字段列表中）的字段，例如：</p>
<pre class="calibre21"><code class="calibre22">$user = User::find(1);
dump($user-&gt;append(['status_text'])-&gt;toArray());</code></pre>
<p class="calibre10">支持设置允许输出的属性，例如：</p>
<pre class="calibre21"><code class="calibre22">$user = User::find(1);
dump($user-&gt;visible(['id','name','email'])-&gt;toArray());</code></pre>
<p class="calibre10">如果是数据集查询的话有两种情况，由于默认的数据集返回结果的类型是一个数组，因此无法调用<code class="calibre7">toArray</code>方法，必须先转成数据集对象然后再使用<code class="calibre7">toArray</code>方法，系统提供了一个<code class="calibre7">collection</code>助手函数实现数据集对象的转换，代码如下：</p>
<pre class="calibre21"><code class="calibre22">$list = User::all();
if($list) {
    $list = collection($list)-&gt;toArray();
}</code></pre>
<p class="calibre10">如果设置了模型的数据集返回类型的话，则可以简化使用</p>
<pre class="calibre21"><code class="calibre22">&lt;?php

namespace app\index\model;

use think\Model;

class User extends Model
{
    protected $resultSetType = 'collection';
}</code></pre>
<p class="calibre10">然后就可以直接使用</p>
<pre class="calibre21"><code class="calibre22">$list = User::all();
$list = $list-&gt;toArray();</code></pre>
<h2 id="%E8%BF%BD%E5%8A%A0%E5%85%B3%E8%81%94%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%B1%9E%E6%80%A7%EF%BC%88%60v5.0.4%2B%60%EF%BC%89" class="calibre15">追加关联模型的属性（<code class="calibre7">V5.0.4+</code>）</h2>
<p class="calibre10"><code class="calibre7">V5.0.4+</code>版本开始，支持追加一对一关联模型的属性到当前模型，例如：</p>
<pre class="calibre21"><code class="calibre22">$user = User::find(1);
dump($user-&gt;appendRelationAttr('profile',['email','nickname'])-&gt;toArray());</code></pre>
<p class="calibre10"><code class="calibre7">profile</code>是关联定义方法名，<code class="calibre7">email</code>和<code class="calibre7">nickname</code>是<code class="calibre7">Profile</code>模型的属性。</p>
<h2 id="%E6%94%AF%E6%8C%81%E5%85%B3%E8%81%94%E5%B1%9E%E6%80%A7%EF%BC%88%60v5.0.5%2B%60%EF%BC%89" class="calibre15">支持关联属性（<code class="calibre7">V5.0.5+</code>）</h2>
<p class="calibre10">模型的<code class="calibre7">visible</code>、<code class="calibre7">hidden</code>和<code class="calibre7">append</code>方法支持关联属性操作，例如：</p>
<pre class="calibre21"><code class="calibre22">$user = User::get(1,'profile');
// 隐藏profile关联属性的email属性
dump($user-&gt;hidden(['profile'=&gt;['email']])-&gt;toArray());
// 或者使用
dump($user-&gt;hidden(['profile.email'])-&gt;toArray());</code></pre>
<p class="calibre10"><code class="calibre7">hidden</code>、<code class="calibre7">visible</code>和<code class="calibre7">append</code>方法同样支持数据集对象。</p>
</div>
	
</body></html>
