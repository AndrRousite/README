<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-CN" xml:lang="zh-CN">
  <head>
    <title>请求缓存</title>
    <meta content="IE=edge" http-equiv="X-UA-Compatible"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="page_styles.css" rel="stylesheet" type="text/css"/>
</head>
  <body class="calibre">
        <h1 class="book-title" id="calibre_toc_67">请求缓存</h1>
<div class="book-content">
    <h2 id="%E8%AF%B7%E6%B1%82%E7%BC%93%E5%AD%98%EF%BC%88%60v5.0.1%60%EF%BC%89" class="calibre15">请求缓存（<code class="calibre7">V5.0.1</code>）</h2>
<p class="calibre10"><code class="calibre7">5.0.1</code>以上版本支持请求缓存功能，支持对请求地址设置缓存访问，并设置有效期。</p>
<table class="calibre25"><thead class="calibre26"><tr class="calibre27"><th class="calibre28">版本</th>
<th class="calibre28">新增功能</th>
</tr></thead><tbody class="calibre29"><tr class="calibre27"><td class="pcalibre1 calibre30">5.0.6</td>
<td class="calibre32 pcalibre1">全局请求缓存支持排除规则</td>
</tr><tr class="calibre27"><td class="pcalibre1 calibre31">5.0.4</td>
<td class="pcalibre1 calibre31">请求缓存支持模块单独开启</td>
</tr><tr class="calibre27"><td class="pcalibre1 calibre31">5.0.3</td>
<td class="calibre33 pcalibre1">增加全局请求缓存支持</td>
</tr></tbody></table><p class="calibre10">请求缓存仅对GET请求有效，有两种方式可以设置请求缓存：</p>
<h3 id="%E8%B7%AF%E7%94%B1%E5%8F%82%E6%95%B0-1" class="calibre17">路由参数</h3>
<p class="calibre10">可以在路由规则里面定义<code class="calibre7">cache</code>参数开启当前路由规则的请求缓存，例如：</p>
<pre class="calibre21"><code class="calibre22">// 定义GET请求路由规则 并设置3600秒的缓存
Route::get('new/:id','News/read',['cache'=&gt;3600]);</code></pre>
<p class="calibre10">第二次访问相同的路由地址的时候，会自动获取请求缓存的数据响应输出，并发送<code class="calibre7">304</code>状态码。</p>
<p class="calibre10">默认请求缓存的标识为当前访问的<code class="calibre7">pathinfo</code>地址，可以定义请求缓存的标识，如下：</p>
<pre class="calibre21"><code class="calibre22">// 定义GET请求路由规则 并设置3600秒的缓存
Route::get('new/:id','News/read',[
    'cache' =&gt;  [ 'new/:id/:page',3600]
]);</code></pre>
<blockquote class="calibre5">
<p class="calibre14"><code class="calibre7">:id</code>、<code class="calibre7">:page</code>表示使用当前请求的param参数进行动态标识替换，也就是根据id和page变量进行3600秒的请求缓存。</p>
</blockquote>
<p class="calibre10">如果cache参数传入false，则表示关闭当前路由的请求缓存（即使开启全局请求缓存）。</p>
<h3 id="%E5%8A%A8%E6%80%81%E8%AE%BE%E7%BD%AE" class="calibre17">动态设置</h3>
<p class="calibre10">可以在<code class="calibre7">app_begin</code>行为里面动态设置请求缓存，例如：</p>
<pre class="calibre21"><code class="calibre22">Request::instance()-&gt;cache('blog/:id',3600);</code></pre>
<p class="calibre10">表示对<code class="calibre7">blog/:id</code>定义的动态访问地址进行3600秒的请求缓存。</p>
<blockquote class="calibre5">
<p class="calibre14">变量支持当前的请求变量（也就是param方法的所有变量）。</p>
</blockquote>
<p class="calibre10">可以使用当前的URL地址作为缓存标识，如下：</p>
<pre class="calibre21"><code class="calibre22">Request::instance()-&gt;cache('__URL__',600);</code></pre>
<p class="calibre10">支持对某个URL后缀的请求进行缓存，例如：</p>
<pre class="calibre21"><code class="calibre22">Request::instance()-&gt;cache('[html]',600);</code></pre>
<p class="calibre10">表示对所有的<code class="calibre7">html</code>后缀访问（GET）请求进行10分钟的缓存。</p>
<p class="calibre10"><code class="calibre7">V5.0.3+</code>版本增加了请求缓存自动判断，只需要在配置文件中开启：</p>
<pre class="calibre21"><code class="calibre22">'request_cache' =&gt;  true,
'request_cache_expire'  =&gt;  3600,</code></pre>
<p class="calibre10">就会自动根据当前请求URL地址（只针对GET请求类型）进行请求缓存，全局缓存有效期为3600秒。</p>
<p class="calibre10"><code class="calibre7">V5.0.4+</code>版本开始可以在模块配置中单独设置开启请求缓存。</p>
<p class="calibre10">路由中设置的请求缓存依然有效并且优先。</p>
<p class="calibre10"><code class="calibre7">V5.0.6+</code>版本开始，全局请求缓存支持设置排除规则，使用方法如下：</p>
<pre class="calibre21"><code class="calibre22">'request_cache' =&gt;  true,
'request_cache_expire'  =&gt;  3600,
'request_cache_except' =&gt;   [
    'blog/index',
    'user/member'
],</code></pre>
<p class="calibre10"><code class="calibre7">request_cache_except</code>设置的规则为不使用请求缓存的地址（不支持变量）开头部分。</p>
</div>
	
</body></html>
