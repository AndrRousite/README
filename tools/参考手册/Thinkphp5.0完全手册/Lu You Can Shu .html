<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-CN" xml:lang="zh-CN">
  <head>
    <title>路由参数</title>
    <meta content="IE=edge" http-equiv="X-UA-Compatible"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="page_styles.css" rel="stylesheet" type="text/css"/>
</head>
  <body class="calibre">
        <h1 class="book-title" id="calibre_toc_31">路由参数</h1>
<div class="book-content">
    <h2 id="%E8%B7%AF%E7%94%B1%E5%8F%82%E6%95%B0" class="calibre15">路由参数</h2>
<p class="calibre10">路由参数是指可以设置一些路由匹配的条件参数，主要用于验证当前的路由规则是否有效，主要包括：</p>
<table class="calibre25"><thead class="calibre26"><tr class="calibre27"><th class="calibre28">参数</th>
<th class="calibre28">说明</th>
</tr></thead><tbody class="calibre29"><tr class="calibre27"><td class="pcalibre1 calibre30">method</td>
<td class="calibre32 pcalibre1">请求类型检测，支持多个请求类型</td>
</tr><tr class="calibre27"><td class="pcalibre1 calibre31">ext</td>
<td class="pcalibre1 calibre31">URL后缀检测，支持匹配多个后缀</td>
</tr><tr class="calibre27"><td class="pcalibre1 calibre31">deny_ext</td>
<td class="pcalibre1 calibre31">URL禁止后缀检测，支持匹配多个后缀</td>
</tr><tr class="calibre27"><td class="pcalibre1 calibre31">https</td>
<td class="pcalibre1 calibre31">检测是否https请求</td>
</tr><tr class="calibre27"><td class="pcalibre1 calibre31">domain</td>
<td class="pcalibre1 calibre31">域名检测</td>
</tr><tr class="calibre27"><td class="pcalibre1 calibre31">before_behavior</td>
<td class="pcalibre1 calibre31">前置行为（检测）</td>
</tr><tr class="calibre27"><td class="pcalibre1 calibre31">after_behavior</td>
<td class="pcalibre1 calibre31">后置行为（执行）</td>
</tr><tr class="calibre27"><td class="pcalibre1 calibre31">callback</td>
<td class="pcalibre1 calibre31">自定义检测方法</td>
</tr><tr class="calibre27"><td class="pcalibre1 calibre31">merge_extra_vars</td>
<td class="pcalibre1 calibre31">合并额外参数</td>
</tr><tr class="calibre27"><td class="pcalibre1 calibre31">bind_model</td>
<td class="pcalibre1 calibre31">绑定模型（<code class="calibre7">V5.0.1+</code>）</td>
</tr><tr class="calibre27"><td class="pcalibre1 calibre31">cache</td>
<td class="pcalibre1 calibre31">请求缓存（<code class="calibre7">V5.0.1+</code>）</td>
</tr><tr class="calibre27"><td class="pcalibre1 calibre31">param_depr</td>
<td class="pcalibre1 calibre31">路由参数分隔符（<code class="calibre7">V5.0.2+</code>）</td>
</tr><tr class="calibre27"><td class="pcalibre1 calibre31">ajax</td>
<td class="pcalibre1 calibre31">Ajax检测（<code class="calibre7">V5.0.2+</code>）</td>
</tr><tr class="calibre27"><td class="pcalibre1 calibre31">pjax</td>
<td class="calibre33 pcalibre1">Pjax检测（<code class="calibre7">V5.0.2+</code>）</td>
</tr></tbody></table><p class="calibre10"><code class="calibre7">V5.0.3+</code>版本对<code class="calibre7">ajax</code>/<code class="calibre7">pjax</code>/<code class="calibre7">https</code>条件支持<code class="calibre7">false</code>。</p>
<blockquote class="calibre5">
<p class="calibre14">这些路由参数可以混合使用，只要有任何一条参数检查不通过，当前路由就不会生效，继续检测后面的路由规则。</p>
</blockquote>
<h3 id="%E8%AF%B7%E6%B1%82%E7%B1%BB%E5%9E%8B" class="calibre17">请求类型</h3>
<p class="calibre10">如果指定请求类型注册路由的话，无需设置<code class="calibre7">method</code>请求类型参数。如果使用了<code class="calibre7">rule</code>或者<code class="calibre7">any</code>方法注册路由，或者使用路由配置定义文件的话，可以单独使用<code class="calibre7">method</code>参数进行请求类型检测。</p>
<p class="calibre10">使用方法：</p>
<pre class="calibre21"><code class="calibre22">// 检测路由规则仅GET请求有效
Route::any('new/:id','News/read',['method'=&gt;'get']);
// 检测路由规则仅GET和POST请求有效
Route::any('new/:id','News/read',['method'=&gt;'get|post']);</code></pre>
<h3 id="url%E5%90%8E%E7%BC%80" class="calibre17">URL后缀</h3>
<pre class="calibre21"><code class="calibre22">// 定义GET请求路由规则 并设置URL后缀为html的时候有效
Route::get('new/:id','News/read',['ext'=&gt;'html']);</code></pre>
<p class="calibre10">支持匹配多个后缀，例如：</p>
<pre class="calibre21"><code class="calibre22">Route::get('new/:id','News/read',['ext'=&gt;'shtml|html']);</code></pre>
<p class="calibre10">可以设置禁止访问的URL后缀，例如：</p>
<pre class="calibre21"><code class="calibre22">// 定义GET请求路由规则 并设置禁止URL后缀为png、jpg和gif的访问
Route::get('new/:id','News/read',['deny_ext'=&gt;'jpg|png|gif']);</code></pre>
<h3 id="%E5%9F%9F%E5%90%8D%E6%A3%80%E6%B5%8B" class="calibre17">域名检测</h3>
<p class="calibre10">支持使用完整域名或者子域名进行检测，例如：</p>
<pre class="calibre21"><code class="calibre22">// 完整域名检测 只在news.thinkphp.cn访问时路由有效
Route::get('new/:id','News/read',['domain'=&gt;'news.thinkphp.cn']);
// 子域名检测
Route::get('new/:id','News/read',['domain'=&gt;'news']);</code></pre>
<h3 id="https%E6%A3%80%E6%B5%8B" class="calibre17">HTTPS检测</h3>
<p class="calibre10">支持检测当前是否HTTPS访问</p>
<pre class="calibre21"><code class="calibre22">Route::get('new/:id','News/read',['https'=&gt;true]);</code></pre>
<h3 id="%E5%89%8D%E7%BD%AE%E8%A1%8C%E4%B8%BA%E6%A3%80%E6%B5%8B" class="calibre17">前置行为检测</h3>
<p class="calibre10">支持使用行为对路由进行检测是否匹配，如果行为方法返回false表示当前路由规则无效。</p>
<pre class="calibre21"><code class="calibre22">Route::get('user/:id','index/User/read',['before_behavior'=&gt;'\app\index\behavior\UserCheck']);</code></pre>
<p class="calibre10">行为类定义如下：</p>
<pre class="calibre21"><code class="calibre22">namespace app\index\behavior;

class UserCheck
{
    public function run()
    {
        if('user/0'==request()-&gt;url()){
            return false;
        }
    }
}</code></pre>
<h3 id="%E5%90%8E%E7%BD%AE%E8%A1%8C%E4%B8%BA%E6%89%A7%E8%A1%8C" class="calibre17">后置行为执行</h3>
<p class="calibre10">可以为某个路由或者某个分组路由定义后置行为执行，表示当路由匹配成功后，执行的行为，例如：</p>
<pre class="calibre21"><code class="calibre22">Route::get('user/:id','User/read',['after_behavior'=&gt;'\app\index\behavior\ReadInfo']);</code></pre>
<p class="calibre10">其中\app\index\behavior\ReadInit 行为类定义如下：</p>
<pre class="calibre21"><code class="calibre22">namespace app\index\behavior;

use app\index\model\User;

class ReadInfo {
    public function run(){
        $id = request()-&gt;route('id');
        request()-&gt;user = User::get($id);
    }
}</code></pre>
<p class="calibre10">如果成功匹配到<code class="calibre7">new/:id</code>路由后，就会执行行为类的run方法，参数是路由地址，可以动态改变。</p>
<h3 id="callback%E6%A3%80%E6%B5%8B" class="calibre17">Callback检测</h3>
<p class="calibre10">也可以支持使用函数检测路由，如果函数返回false则表示当前路由规则无效，例如：</p>
<pre class="calibre21"><code class="calibre22">Route::get('new/:id','News/read',['callback'=&gt;'my_check_fun']);</code></pre>
<h3 id="%E5%90%88%E5%B9%B6%E9%A2%9D%E5%A4%96%E5%8F%82%E6%95%B0" class="calibre17">合并额外参数</h3>
<p class="calibre10">通常用于完整匹配的情况，如果有额外的参数则合并作为变量值，例如：</p>
<pre class="calibre21"><code class="calibre22">Route::get('new/:name$','News/read',['merge_extra_vars'=&gt;true]);</code></pre>
<p class="calibre10"><a href="http://serverName/new/thinkphp/hello" class="pcalibre calibre13">http://serverName/new/thinkphp/hello</a></p>
<p class="calibre10">会被匹配到，并且<code class="calibre7">name</code>变量的值为 <code class="calibre7">thinkphp/hello</code>。</p>
<h3 id="%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%B8%AD%E6%B7%BB%E5%8A%A0%E8%B7%AF%E7%94%B1%E5%8F%82%E6%95%B0" class="calibre17">配置文件中添加路由参数</h3>
<p class="calibre10">如果使用配置文件的话，可以使用：</p>
<pre class="calibre21"><code class="calibre22">return [
    'blog/:id'   =&gt; ['Blog/update',['method' =&gt; 'post','ext'=&gt;'html|shtml']],
];</code></pre>
<h3 id="%E8%B7%AF%E7%94%B1%E7%BB%91%E5%AE%9A%E6%A8%A1%E5%9E%8B%EF%BC%88%60v5.0.1%60%EF%BC%89" class="calibre17">路由绑定模型（<code class="calibre7">V5.0.1</code>）</h3>
<p class="calibre10">可以在当前路由匹配后绑定模型，后面则同过方法的对象自动注入来获取。</p>
<pre class="calibre21"><code class="calibre22">Route::get('new/:name$','News/read',['bind_model'=&gt;['User','name']]);</code></pre>
<p class="calibre10">更多细节可以参考请求-&gt;依赖注入。</p>
<h3 id="%E7%BC%93%E5%AD%98%E8%B7%AF%E7%94%B1%E8%AF%B7%E6%B1%82" class="calibre17">缓存路由请求</h3>
<p class="calibre10">可以对当前的路由请求进行缓存处理，例如：</p>
<pre class="calibre21"><code class="calibre22">Route::get('new/:name$','News/read',['cache'=&gt;3600]);</code></pre>
<p class="calibre10">表示对当前路由请求缓存3600秒。</p>
</div>
	
</body></html>
