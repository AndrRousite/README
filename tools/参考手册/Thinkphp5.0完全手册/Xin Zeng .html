<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-CN" xml:lang="zh-CN">
  <head>
    <title>新增</title>
    <meta content="IE=edge" http-equiv="X-UA-Compatible"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="page_styles.css" rel="stylesheet" type="text/css"/>
</head>
  <body class="calibre">
        <h1 class="book-title" id="calibre_toc_94">新增</h1>
<div class="book-content">
    <p class="calibre10">新增数据有多种方式。</p>
<h2 id="%E6%B7%BB%E5%8A%A0%E4%B8%80%E6%9D%A1%E6%95%B0%E6%8D%AE-1" class="calibre15">添加一条数据</h2>
<p class="calibre10">第一种是实例化模型对象后赋值并保存：</p>
<pre class="calibre21"><code class="calibre22">$user           = new User;
$user-&gt;name     = 'thinkphp';
$user-&gt;email    = 'thinkphp@qq.com';
$user-&gt;save();</code></pre>
<p class="calibre10">也可以使用<code class="calibre7">data</code>方法批量赋值：</p>
<pre class="calibre21"><code class="calibre22">$user = new User;
$user-&gt;data([
    'name'  =&gt;  'thinkphp',
    'email' =&gt;  'thinkphp@qq.com'
]);
$user-&gt;save();</code></pre>
<p class="calibre10">或者直接在实例化的时候传入数据</p>
<pre class="calibre21"><code class="calibre22">$user = new User([
    'name'  =&gt;  'thinkphp',
    'email' =&gt;  'thinkphp@qq.com'
]);
$user-&gt;save();</code></pre>
<p class="calibre10">如果需要过滤非数据表字段的数据，可以使用：</p>
<pre class="calibre21"><code class="calibre22">$user = new User($_POST);
// 过滤post数组中的非数据表字段数据
$user-&gt;allowField(true)-&gt;save();</code></pre>
<p class="calibre10">如果你通过外部提交赋值给模型，并且希望指定某些字段写入，可以使用：</p>
<pre class="calibre21"><code class="calibre22">$user = new User($_POST);
// post数组中只有name和email字段会写入
$user-&gt;allowField(['name','email'])-&gt;save();</code></pre>
<blockquote class="calibre5">
<p class="calibre14">save方法新增数据返回的是写入的记录数。</p>
</blockquote>
<h2 id="%E8%8E%B7%E5%8F%96%E8%87%AA%E5%A2%9Eid" class="calibre15">获取自增ID</h2>
<p class="calibre10">如果要获取新增数据的自增ID，可以使用下面的方式：</p>
<pre class="calibre21"><code class="calibre22">$user           = new User;
$user-&gt;name     = 'thinkphp';
$user-&gt;email    = 'thinkphp@qq.com';
$user-&gt;save();
// 获取自增ID
echo $user-&gt;id;</code></pre>
<p class="calibre10">注意这里其实是获取模型的主键，如果你的主键不是<code class="calibre7">id</code>，而是<code class="calibre7">user_id</code>的话，其实获取自增ID就变成这样：</p>
<pre class="calibre21"><code class="calibre22">$user           = new User;
$user-&gt;name     = 'thinkphp';
$user-&gt;email    = 'thinkphp@qq.com';
$user-&gt;save();
// 获取自增ID
echo $user-&gt;user_id;</code></pre>
<p class="calibre10">注意不要在同一个实例里面多次新增数据，如果确实需要多次新增，那么可以用下面的方式：</p>
<pre class="calibre21"><code class="calibre22">$user           = new User;
$user-&gt;name     = 'thinkphp';
$user-&gt;email    = 'thinkphp@qq.com';
$user-&gt;save();
$user-&gt;name     = 'onethink';
$user-&gt;email    = 'onethink@qq.com';
// 第二次开始必须使用下面的方式新增
$user-&gt;isUpdate(false)-&gt;save();</code></pre>
<h2 id="%E6%B7%BB%E5%8A%A0%E5%A4%9A%E6%9D%A1%E6%95%B0%E6%8D%AE-1" class="calibre15">添加多条数据</h2>
<p class="calibre10">支持批量新增，可以使用：</p>
<pre class="calibre21"><code class="calibre22">$user = new User;
$list = [
    ['name'=&gt;'thinkphp','email'=&gt;'thinkphp@qq.com'],
    ['name'=&gt;'onethink','email'=&gt;'onethink@qq.com']
];
$user-&gt;saveAll($list);</code></pre>
<blockquote class="calibre5">
<p class="calibre14">saveAll方法新增数据返回的是包含新增模型（带自增ID）的数据集（数组）。</p>
</blockquote>
<p class="calibre10"><code class="calibre7">saveAll</code>方法新增数据默认会自动识别数据是需要新增还是更新操作，当数据中存在主键的时候会认为是更新操作，如果你需要带主键数据批量新增，可以使用下面的方式：</p>
<pre class="calibre21"><code class="calibre22">$user = new User;
$list = [
    ['id'=&gt;1, 'name'=&gt;'thinkphp', 'email'=&gt;'thinkphp@qq.com'],
    ['id'=&gt;2, 'name'=&gt;'onethink', 'email'=&gt;'onethink@qq.com'],
];
$user-&gt;saveAll($list, false);</code></pre>
<p class="calibre10">如果你自己通过遍历批量新增数据，可以参考下面的方法：</p>
<pre class="calibre21"><code class="calibre22">$user = new User;
$list = [
    ['name'=&gt;'thinkphp','email'=&gt;'thinkphp@qq.com'],
    ['name'=&gt;'onethink','email'=&gt;'onethink@qq.com']
];
foreach($list as $data){
    $user-&gt;data($data,true)-&gt;isUpdate(false)-&gt;save();
}</code></pre>
<h2 id="%E9%9D%99%E6%80%81%E6%96%B9%E6%B3%95" class="calibre15">静态方法</h2>
<p class="calibre10">还可以直接静态调用<code class="calibre7">create</code>方法创建并写入：</p>
<pre class="calibre21"><code class="calibre22">$user = User::create([
    'name'  =&gt;  'thinkphp',
    'email' =&gt;  'thinkphp@qq.com'
]);
echo $user-&gt;name;
echo $user-&gt;email;
echo $user-&gt;id; // 获取自增ID</code></pre>
<blockquote class="calibre5">
<p class="calibre14">和save方法不同的是，create方法返回的是当前模型的对象实例。</p>
</blockquote>
<h2 id="%E5%8A%A9%E6%89%8B%E5%87%BD%E6%95%B0-4" class="calibre15">助手函数</h2>
<p class="calibre10">系统提供了model助手函数用于快速实例化模型，并且使用单例实现，例如：</p>
<pre class="calibre21"><code class="calibre22">// 使用model助手函数实例化User模型
$user = model('User');
// 模型对象赋值
$user-&gt;data([
    'name'  =&gt;  'thinkphp',
    'email' =&gt;  'thinkphp@qq.com'
]);
$user-&gt;save();</code></pre>
<p class="calibre10">或者进行批量新增：</p>
<pre class="calibre21"><code class="calibre22">$user = model('User');
// 批量新增
$list = [
    ['name'=&gt;'thinkphp','email'=&gt;'thinkphp@qq.com'],
    ['name'=&gt;'onethink','email'=&gt;'onethink@qq.com']
];
$user-&gt;saveAll($list);</code></pre>
</div>
	
</body></html>
