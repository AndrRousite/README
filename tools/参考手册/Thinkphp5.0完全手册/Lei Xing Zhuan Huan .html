<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-CN" xml:lang="zh-CN">
  <head>
    <title>类型转换</title>
    <meta content="IE=edge" http-equiv="X-UA-Compatible"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="page_styles.css" rel="stylesheet" type="text/css"/>
</head>
  <body class="calibre">
        <h1 class="book-title" id="calibre_toc_104">类型转换</h1>
<div class="book-content">
    <p class="calibre10">支持给字段设置类型自动转换，会在写入和读取的时候自动进行类型转换处理，例如：</p>
<pre class="calibre21"><code class="calibre22">class User extends Model 
{
    protected $type = [
        'status'    =&gt;  'integer',
        'score'     =&gt;  'float',
        'birthday'  =&gt;  'datetime',
        'info'      =&gt;  'array',
    ];
}</code></pre>
<p class="calibre10">下面是一个类型自动转换的示例：</p>
<pre class="calibre21"><code class="calibre22">$user = new User;
$user-&gt;status = '1';
$user-&gt;score = '90.50';
$user-&gt;birthday = '2015/5/1';
$user-&gt;info = ['a'=&gt;1,'b'=&gt;2];
$user-&gt;save();
var_dump($user-&gt;status); // int 1
var_dump($user-&gt;score); // float 90.5;
var_dump($user-&gt;birthday); // string '2015-05-01 00:00:00'
var_dump($user-&gt;info);// array (size=2) 'a' =&gt; int 1  'b' =&gt; int 2</code></pre>
<p class="calibre10">数据库查询默认取出来的数据都是字符串类型，如果需要转换为其他的类型，需要设置，支持的类型包括如下类型：</p>
<h2 id="%60integer%60" class="calibre15"><code class="calibre7">integer</code></h2>
<p class="calibre10">设置为integer（整型）后，该字段写入和输出的时候都会自动转换为整型。</p>
<h2 id="%60float%60" class="calibre15"><code class="calibre7">float</code></h2>
<p class="calibre10">该字段的值写入和输出的时候自动转换为浮点型。</p>
<h2 id="%60boolean%60" class="calibre15"><code class="calibre7">boolean</code></h2>
<p class="calibre10">该字段的值写入和输出的时候自动转换为布尔型。</p>
<h2 id="%60array%60" class="calibre15"><code class="calibre7">array</code></h2>
<p class="calibre10">如果设置为强制转换为<code class="calibre7">array</code>类型，系统会自动把数组编码为json格式字符串写入数据库，取出来的时候会自动解码。</p>
<h2 id="%60object%60" class="calibre15"><code class="calibre7">object</code></h2>
<p class="calibre10">该字段的值在写入的时候会自动编码为json字符串，输出的时候会自动转换为<code class="calibre7">stdclass</code>对象。</p>
<h2 id="%60serialize%60" class="calibre15"><code class="calibre7">serialize</code></h2>
<p class="calibre10">指定为序列化类型的话，数据会自动序列化写入，并且在读取的时候自动反序列化。</p>
<h2 id="%60json%60" class="calibre15"><code class="calibre7">json</code></h2>
<p class="calibre10">指定为<code class="calibre7">json</code>类型的话，数据会自动<code class="calibre7">json_encode</code>写入，并且在读取的时候自动<code class="calibre7">json_decode</code>处理。</p>
<h2 id="%60timestamp%60" class="calibre15"><code class="calibre7">timestamp</code></h2>
<p class="calibre10">指定为时间戳字段类型的话，该字段的值在写入时候会自动使用<code class="calibre7">strtotime</code>生成对应的时间戳，输出的时候会自动转换为<code class="calibre7">dateFormat</code>属性定义的时间字符串格式，默认的格式为<code class="calibre7">Y-m-d H:i:s</code>，如果希望改变其他格式，可以定义如下：</p>
<pre class="calibre21"><code class="calibre22">class User extends Model 
{
    protected $dateFormat = 'Y/m/d';
    protected $type = [
        'status'    =&gt;  'integer',
        'score'     =&gt;  'float',
        'birthday'  =&gt;  'timestamp',
    ];
}</code></pre>
<p class="calibre10">或者在类型转换定义的时候使用：</p>
<pre class="calibre21"><code class="calibre22">class User extends Model 
{
    protected $type = [
        'status'    =&gt;  'integer',
        'score'     =&gt;  'float',
        'birthday'  =&gt;  'timestamp:Y/m/d',
    ];
}</code></pre>
<p class="calibre10">然后就可以</p>
<pre class="calibre21"><code class="calibre22">$user = User::find(1);
echo $user-&gt;birthday; // 2015/5/1</code></pre>
<h2 id="%60datetime%60" class="calibre15"><code class="calibre7">datetime</code></h2>
<p class="calibre10">和<code class="calibre7">timestamp</code>类似，区别在于写入和读取数据的时候都会自动处理成时间字符串<code class="calibre7">Y-m-d H:i:s</code>的格式。</p>
</div>
	
</body></html>
