<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-CN" xml:lang="zh-CN">
  <head>
    <title>URL生成</title>
    <meta content="IE=edge" http-equiv="X-UA-Compatible"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="page_styles.css" rel="stylesheet" type="text/css"/>
</head>
  <body class="calibre">
        <h1 class="book-title" id="calibre_toc_42">URL生成</h1>
<div class="book-content">
    <p class="calibre10">ThinkPHP5.0支持路由URL地址的统一生成，并且支持所有的路由方式，以及完美解决了路由地址的反转解析，无需再为路由定义和变化而改变URL生成。</p>
<p class="calibre10">URL生成使用 <code class="calibre7">\think\Url::build()</code> 方法或者使用系统提供的助手函数<code class="calibre7">url()</code>，参数一致：</p>
<blockquote class="calibre5">
<h4 id="url%3A%3Abuild%28%27%E5%9C%B0%E5%9D%80%E8%A1%A8%E8%BE%BE%E5%BC%8F%27%2C%5B%27%E5%8F%82%E6%95%B0%27%5D%2C%5B%27url%E5%90%8E%E7%BC%80%27%5D%2C%5B%27%E5%9F%9F%E5%90%8D%27%5D%29" class="calibre6">Url::build('地址表达式',['参数'],['URL后缀'],['域名'])</h4>
<h4 id="url%28%27%E5%9C%B0%E5%9D%80%E8%A1%A8%E8%BE%BE%E5%BC%8F%27%2C%5B%27%E5%8F%82%E6%95%B0%27%5D%2C%5B%27url%E5%90%8E%E7%BC%80%27%5D%2C%5B%27%E5%9F%9F%E5%90%8D%27%5D%29" class="calibre6">url('地址表达式',['参数'],['URL后缀'],['域名'])</h4>
</blockquote>
<h2 id="%E5%9C%B0%E5%9D%80%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%92%8C%E5%8F%82%E6%95%B0" class="calibre15">地址表达式和参数</h2>
<p class="calibre10">对使用不同的路由地址方式，地址表达式的定义有所区别。参数单独通过第二个参数传入，假设我们定义了一个路由规则如下：</p>
<pre class="calibre21"><code class="calibre22">Route::rule('blog/:id','index/blog/read');</code></pre>
<p class="calibre10">就可以使用下面的方式来生成URL地址：</p>
<pre class="calibre21"><code class="calibre22">Url::build('index/blog/read','id=5&amp;name=thinkphp');
Url::build('index/blog/read',['id'=&gt;5,'name'=&gt;'thinkphp']);
url('index/blog/read','id=5&amp;name=thinkphp');
url('index/blog/read',['id'=&gt;5,'name'=&gt;'thinkphp']);</code></pre>
<p class="calibre10">下面我们统一使用第一种方式讲解。</p>
<h3 id="%E4%BD%BF%E7%94%A8%E6%A8%A1%E5%9D%97%2F%E6%8E%A7%E5%88%B6%E5%99%A8%2F%E6%93%8D%E4%BD%9C%E7%94%9F%E6%88%90" class="calibre17">使用模块/控制器/操作生成</h3>
<p class="calibre10">如果你的路由方式是路由到模块/控制器/操作，那么可以直接写</p>
<pre class="calibre21"><code class="calibre22">// 生成index模块 blog控制器的read操作 URL访问地址
Url::build('index/blog/read','id=5&amp;name=thinkphp');
// 使用助手函数
url('index/blog/read','id=5&amp;name=thinkphp');</code></pre>
<p class="calibre10">以上方法都会生成下面的URL地址：</p>
<pre class="calibre21"><code class="calibre22">/index.php/blog/5/name/thinkphp.html</code></pre>
<blockquote class="calibre5">
<p class="calibre14">注意，生成方法的第一个参数必须和路由定义的路由地址保持一致，如果写成下面的方式可能无法正确生成URL地址：</p>
<pre class="calibre24"><code class="calibre22">Url::build('blog/read','id=5&amp;name=thinkphp');</code></pre>
</blockquote>
<p class="calibre10">如果你的环境支持REWRITE，那么生成的URL地址会变为：</p>
<pre class="calibre21"><code class="calibre22">/blog/5/name/thinkphp.html</code></pre>
<p class="calibre10">如果你配置了：</p>
<pre class="calibre21"><code class="calibre22">'url_common_param'=&gt;true</code></pre>
<p class="calibre10">那么生成的URL地址变为：</p>
<pre class="calibre21"><code class="calibre22">/index.php/blog/5.html?name=thinkphp</code></pre>
<p class="calibre10">不在路由规则里面的变量会直接使用普通URL参数的方式。</p>
<blockquote class="calibre5">
<p class="calibre14">需要注意的是，URL地址生成不会检测路由的有效性，只是按照给定的路由地址和参数生成符合条件的路由规则。</p>
</blockquote>
<h3 id="%E4%BD%BF%E7%94%A8%E6%8E%A7%E5%88%B6%E5%99%A8%E7%9A%84%E6%96%B9%E6%B3%95%E7%94%9F%E6%88%90" class="calibre17">使用控制器的方法生成</h3>
<p class="calibre10">如果你的路由地址是采用控制器的方法，并且路由定义如下：</p>
<pre class="calibre21"><code class="calibre22">// 这里采用配置方式定义路由 动态注册的方式一样有效
'blog/:id'  =&gt; '@index/blog/read'</code></pre>
<p class="calibre10">那么可以使用如下方式生成：</p>
<pre class="calibre21"><code class="calibre22">// 生成index模块 blog控制器的read操作 URL访问地址
Url::build('@index/blog/read','id=5');
// 使用助手函数
url('@index/blog/read','id=5');</code></pre>
<p class="calibre10">那么自动生成的URL地址变为：</p>
<pre class="calibre21"><code class="calibre22">/index.php/blog/5.html</code></pre>
<h3 id="%E4%BD%BF%E7%94%A8%E7%B1%BB%E7%9A%84%E6%96%B9%E6%B3%95%E7%94%9F%E6%88%90" class="calibre17">使用类的方法生成</h3>
<p class="calibre10">如果你的路由地址是路由到类的方法，并且做了如下路由规则定义：</p>
<pre class="calibre21"><code class="calibre22">// 这里采用配置方式定义路由 动态注册的方式一样有效
Route::rule(['blog','blog/:id'],'\app\index\controller\blog@read');</code></pre>
<p class="calibre10">如果路由地址是到类的方法，需要首先给路由定义命名标识，然后使用标识快速生成URL地址。</p>
<p class="calibre10">那么可以使用如下方式生成：</p>
<pre class="calibre21"><code class="calibre22">// 生成index模块 blog控制器的read操作 URL访问地址
Url::build('blog?id=5');
url('blog?id=5');</code></pre>
<p class="calibre10">那么自动生成的URL地址变为：</p>
<pre class="calibre21"><code class="calibre22">/index.php/blog/5.html</code></pre>
<h3 id="%E7%9B%B4%E6%8E%A5%E4%BD%BF%E7%94%A8%E8%B7%AF%E7%94%B1%E5%9C%B0%E5%9D%80" class="calibre17">直接使用路由地址</h3>
<p class="calibre10">我们也可以直接使用路由地址来生成URL，例如：</p>
<p class="calibre10">我们定义了路由规则如下：</p>
<pre class="calibre21"><code class="calibre22">'blog/:id' =&gt; 'index/blog/read'</code></pre>
<p class="calibre10">可以使用下面的方式直接使用路由规则生成URL地址：</p>
<pre class="calibre21"><code class="calibre22">Url::build('/blog/5');</code></pre>
<p class="calibre10">那么自动生成的URL地址变为：</p>
<pre class="calibre21"><code class="calibre22">/index.php/blog/5.html</code></pre>
<h2 id="url%E5%90%8E%E7%BC%80-1" class="calibre15">URL后缀</h2>
<p class="calibre10">默认情况下，系统会自动读取<code class="calibre7">url_html_suffix</code>配置参数作为URL后缀（默认为html），如果我们设置了：</p>
<pre class="calibre21"><code class="calibre22">'url_html_suffix'   =&gt; 'shtml'</code></pre>
<p class="calibre10">那么自动生成的URL地址变为：</p>
<pre class="calibre21"><code class="calibre22">/index.php/blog/5.shtml</code></pre>
<p class="calibre10">如果我们设置了多个URL后缀支持</p>
<pre class="calibre21"><code class="calibre22">'url_html_suffix'   =&gt; 'html|shtml'</code></pre>
<p class="calibre10">则会取第一个后缀来生成URL地址，所以自动生成的URL地址还是：</p>
<pre class="calibre21"><code class="calibre22">/index.php/blog/5.html</code></pre>
<p class="calibre10">如果你希望指定URL后缀生成，则可以使用：</p>
<pre class="calibre21"><code class="calibre22">Url::build('index/blog/read','id=5','shtml');
url('index/blog/read','id=5','shtml');</code></pre>
<h2 id="%E5%9F%9F%E5%90%8D%E7%94%9F%E6%88%90" class="calibre15">域名生成</h2>
<p class="calibre10">默认生成的URL地址是不带域名的，如果你采用了多域名部署或者希望生成带有域名的URL地址的话，就需要传入第四个参数，该参数有两种用法：</p>
<h3 id="%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%E5%9F%9F%E5%90%8D" class="calibre17">自动生成域名</h3>
<pre class="calibre21"><code class="calibre22">Url::build('index/blog/read','id=5','shtml',true);
url('index/blog/read','id=5','shtml',true);</code></pre>
<p class="calibre10">第四个参数传入<code class="calibre7">true</code>的话，表示自动生成域名，如果你开启了<code class="calibre7">url_domain_deploy</code>还会自动识别匹配当前URL规则的域名。</p>
<p class="calibre10">例如，我们注册了域名路由信息如下：</p>
<pre class="calibre21"><code class="calibre22">Route::domain('blog','index/blog');</code></pre>
<p class="calibre10">那么上面的URL地址生成为：</p>
<pre class="calibre21"><code class="calibre22">http://blog.thinkphp.cn/read/id/5.shtml</code></pre>
<h3 id="%E6%8C%87%E5%AE%9A%E5%9F%9F%E5%90%8D" class="calibre17">指定域名</h3>
<p class="calibre10">你也可以显式传入需要生成地址的域名，例如：</p>
<pre class="calibre21"><code class="calibre22">Url::build('index/blog/read','id=5','shtml','blog');
url('index/blog/read','id=5','shtml','blog');</code></pre>
<p class="calibre10">或者传入完整的域名</p>
<pre class="calibre21"><code class="calibre22">Url::build('index/blog/read','id=5','shtml','blog.thinkphp.cn');
url('index/blog/read','id=5','shtml','blog.thinkphp.cn');</code></pre>
<p class="calibre10">生成的URL地址为：</p>
<pre class="calibre21"><code class="calibre22">http://blog.thinkphp.cn/read/id/5.shtml</code></pre>
<p class="calibre10">也可以直接在第一个参数里面传入域名，例如：</p>
<pre class="calibre21"><code class="calibre22">Url::build('index/blog/read@blog','id=5');
url('index/blog/read@blog','id=5');
url('index/blog/read@blog.thinkphp.cn','id=5');</code></pre>
<h2 id="%E7%94%9F%E6%88%90%E9%94%9A%E7%82%B9" class="calibre15">生成锚点</h2>
<p class="calibre10">支持生成URL的锚点，可以直接在URL地址参数中使用：</p>
<pre class="calibre21"><code class="calibre22">Url::build('index/blog/read#anchor@blog','id=5');
url('index/blog/read#anchor@blog','id=5');</code></pre>
<blockquote class="calibre5">
<p class="calibre14">锚点和域名一起使用的时候，注意锚点在前面，域名在后面。</p>
</blockquote>
<p class="calibre10">生成的URL地址为：</p>
<pre class="calibre21"><code class="calibre22">http://blog.thinkphp.cn/read/id/5.html#anchor</code></pre>
<h2 id="%E9%9A%90%E8%97%8F%E6%88%96%E8%80%85%E5%8A%A0%E4%B8%8A%E5%85%A5%E5%8F%A3%E6%96%87%E4%BB%B6" class="calibre15">隐藏或者加上入口文件</h2>
<p class="calibre10">有时候我们生成的URL地址可能需要加上<code class="calibre7">index.php</code>或者去掉<code class="calibre7">index.php</code>，大多数时候系统会自动判断，如果发现自动生成的地址有问题，可以直接在调用<code class="calibre7">build</code>方法之前调用<code class="calibre7">root</code>方法，例如加上<code class="calibre7">index.php</code>：</p>
<pre class="calibre21"><code class="calibre22">Url::root('/index.php');
Url::build('index/blog/read','id=5');</code></pre>
<p class="calibre10">或者隐藏<code class="calibre7">index.php</code>：</p>
<pre class="calibre21"><code class="calibre22">Url::root('/');
Url::build('index/blog/read','id=5');</code></pre>
<blockquote class="calibre5">
<p class="calibre14"><code class="calibre7">root</code>方法只需要调用一次即可。</p>
</blockquote>
</div>
	
</body></html>
