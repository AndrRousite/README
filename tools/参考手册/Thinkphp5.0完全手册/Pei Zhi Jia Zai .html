<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-CN" xml:lang="zh-CN">
  <head>
    <title>配置加载</title>
    <meta content="IE=edge" http-equiv="X-UA-Compatible"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="page_styles.css" rel="stylesheet" type="text/css"/>
</head>
  <body class="calibre">
        <h1 class="book-title" id="calibre_toc_19">配置加载</h1>
<div class="book-content">
    <p class="calibre10">在ThinkPHP中，一般来说应用的配置文件是自动加载的，加载的顺序是：</p>
<blockquote class="info">
<h4 id="%E6%83%AF%E4%BE%8B%E9%85%8D%E7%BD%AE-%3E%E5%BA%94%E7%94%A8%E9%85%8D%E7%BD%AE-%3E%E6%89%A9%E5%B1%95%E9%85%8D%E7%BD%AE-%3E%E5%9C%BA%E6%99%AF%E9%85%8D%E7%BD%AE-%3E%E6%A8%A1%E5%9D%97%E9%85%8D%E7%BD%AE-%3E%E5%8A%A8%E6%80%81%E9%85%8D%E7%BD%AE" class="calibre6">惯例配置-&gt;应用配置-&gt;扩展配置-&gt;场景配置-&gt;模块配置-&gt;动态配置</h4>
</blockquote>
<p class="calibre10">以上是配置文件的加载顺序，因为后面的配置会覆盖之前的同名配置（在没有生效的前提下），所以配置的优先顺序从右到左。</p>
<p class="calibre10">下面说明下不同的配置文件的区别和位置：</p>
<h2 id="%E6%83%AF%E4%BE%8B%E9%85%8D%E7%BD%AE" class="calibre15">惯例配置</h2>
<p class="calibre10">惯例重于配置是系统遵循的一个重要思想，框架内置有一个惯例配置文件（位于<code class="calibre7">thinkphp/convention.php</code>），按照大多数的使用对常用参数进行了默认配置。所以，对于应用的配置文件，往往只需要配置和惯例配置不同的或者新增的配置参数，如果你完全采用默认配置，甚至可以不需要定义任何配置文件。</p>
<blockquote class="calibre5">
<p class="calibre14">建议仔细阅读下系统的惯例配置文件中的相关配置参数，了解下系统默认的配置参数。</p>
</blockquote>
<h2 id="%E5%BA%94%E7%94%A8%E9%85%8D%E7%BD%AE" class="calibre15">应用配置</h2>
<p class="calibre10">应用配置文件是应用初始化的时候首先加载的公共配置文件，默认位于<code class="calibre7">application/config.php</code>。</p>
<h2 id="%E6%89%A9%E5%B1%95%E9%85%8D%E7%BD%AE" class="calibre15">扩展配置</h2>
<p class="calibre10">扩展配置文件是由<code class="calibre7">extra_config_list</code>配置参数定义的额外的配置文件，默认会加载<code class="calibre7">database</code>和<code class="calibre7">validate</code>两个扩展配置文件。</p>
<blockquote class="danger">
<p class="calibre14"><code class="calibre7">V5.0.1</code>开始，取消了该配置参数，扩展配置文件直接放入<code class="calibre7">application/extra</code>目录会自动加载。</p>
</blockquote>
<h2 id="%E5%9C%BA%E6%99%AF%E9%85%8D%E7%BD%AE" class="calibre15">场景配置</h2>
<p class="calibre10">每个应用都可以在不同的情况下设置自己的状态（或者称之为应用场景），并且加载不同的配置文件。</p>
<p class="calibre10">举个例子，你需要在公司和家里分别设置不同的数据库测试环境。那么可以这样处理，在公司环境中，我们在应用配置文件中配置：</p>
<pre class="calibre21"><code class="calibre22">'app_status'=&gt;'office'</code></pre>
<p class="calibre10">那么就会自动加载该状态对应的配置文件（默认位于<code class="calibre7">application/office.php</code>）。</p>
<p class="calibre10">如果我们回家后，我们修改定义为：</p>
<pre class="calibre21"><code class="calibre22">'app_status'=&gt;'home'</code></pre>
<p class="calibre10">那么就会自动加载该状态对应的配置文件（位于<code class="calibre7">application/home.php</code>）。</p>
<blockquote class="calibre5">
<p class="calibre14">状态配置文件是可选的</p>
</blockquote>
<h2 id="%E6%A8%A1%E5%9D%97%E9%85%8D%E7%BD%AE" class="calibre15">模块配置</h2>
<p class="calibre10">每个模块会自动加载自己的配置文件（位于<code class="calibre7">application/当前模块名/config.php</code>）。</p>
<p class="calibre10">模块还可以支持独立的状态配置文件，命名规范为：<code class="calibre7">application/当前模块名/应用状态.php</code>。</p>
<blockquote class="calibre5">
<p class="calibre14">模块配置文件是可选的</p>
</blockquote>
<p class="calibre10">如果你的应用的配置文件比较大，想分成几个单独的配置文件或者需要加载额外的配置文件的话，可以考虑采用扩展配置或者动态配置（参考后面的描述）。</p>
<h3 id="%E5%8A%A0%E8%BD%BD%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6" class="calibre17">加载配置文件</h3>
<pre class="calibre21"><code class="calibre22">Config::load('配置文件名');</code></pre>
<p class="calibre10">配置文件一般位于<code class="calibre7">APP_PATH</code>目录下面，如果需要加载其它位置的配置文件，需要使用完整路径，例如：</p>
<pre class="calibre21"><code class="calibre22">Config::load(APP_PATH.'config/config.php');</code></pre>
<p class="calibre10">系统默认的配置定义格式是PHP返回数组的方式，例如：</p>
<pre class="calibre21"><code class="calibre22">return [
    '配置参数1'=&gt;'配置值',
    '配置参数1'=&gt;'配置值',
    // ... 更多配置
 ];</code></pre>
<p class="calibre10">如果你定义格式是其他格式的话，可以使用<code class="calibre7">parse</code>方法来导入，例如：</p>
<pre class="calibre21"><code class="calibre22">Config::parse(APP_PATH.'my_config.ini','ini');
Config::parse(APP_PATH.'my_config.xml','xml');</code></pre>
<p class="calibre10">parse方法的第一个参数需要传入完整的文件名或者配置内容。</p>
<p class="calibre10">如果不传入第二个参数的话，系统会根据配置文件名自动识别配置类型，所以下面的写法仍然是支持的：</p>
<pre class="calibre21"><code class="calibre22">Config::parse('my_config.ini');</code></pre>
<p class="calibre10">parse方法除了支持读取配置文件外，也支持直接传入配置内容，例如：</p>
<pre class="calibre21"><code class="calibre22">$config = 'var1=val
var2=val';
Config::parse($config,'ini');</code></pre>
<p class="calibre10">支持传入配置文件内容的时候 第二个参数必须显式指定。</p>
<p class="calibre10">标准的ini格式文件定义：</p>
<pre class="calibre21"><code class="calibre22">配置参数1=配置值
配置参数2=配置值</code></pre>
<p class="calibre10">标准的xml格式文件定义：</p>
<pre class="calibre21"><code class="calibre22">&lt;config&gt;
 &lt;var1&gt;val1&lt;/var1&gt;
 &lt;var2&gt;val2&lt;/var2&gt;
 &lt;/config&gt;</code></pre>
<p class="calibre10">配置类采用驱动方式支持各种不同的配置文件类型，因此可以根据需要随意扩展。</p>
</div>
	
</body></html>
