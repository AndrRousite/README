<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-CN" xml:lang="zh-CN">
  <head>
    <title>更新数据</title>
    <meta content="IE=edge" http-equiv="X-UA-Compatible"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="page_styles.css" rel="stylesheet" type="text/css"/>
</head>
  <body class="calibre">
        <h1 class="book-title" id="calibre_toc_74">更新数据</h1>
<div class="book-content">
    <table class="calibre25"><thead class="calibre26"><tr class="calibre27"><th class="calibre28">版本</th>
<th class="calibre28">调整功能</th>
</tr></thead><tbody class="calibre29"><tr class="calibre27"><td class="pcalibre1 calibre30">5.0.5</td>
<td class="calibre34 pcalibre1">添加<code class="calibre7">data</code>/<code class="calibre7">inc</code>/<code class="calibre7">dec</code>/<code class="calibre7">exp</code>方法设置数据</td>
</tr></tbody></table><h2 id="%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AE%E8%A1%A8%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE" class="calibre15">更新数据表中的数据</h2>
<pre class="calibre21"><code class="calibre22">Db::table('think_user')
    -&gt;where('id', 1)
    -&gt;update(['name' =&gt; 'thinkphp']);</code></pre>
<p class="calibre10">如果数据中包含主键，可以直接使用：</p>
<pre class="calibre21"><code class="calibre22">Db::table('think_user')
    -&gt;update(['name' =&gt; 'thinkphp','id'=&gt;1]);</code></pre>
<blockquote class="calibre5">
<p class="calibre14">update 方法返回影响数据的条数，没修改任何数据返回 0</p>
</blockquote>
<p class="calibre10">如果要更新的数据需要使用<code class="calibre7">SQL</code>函数或者其它字段，可以使用下面的方式：</p>
<pre class="calibre21"><code class="calibre22">Db::table('think_user')
    -&gt;where('id', 1)
    -&gt;update([
        'login_time'  =&gt; ['exp','now()'],
        'login_times' =&gt; ['exp','login_times+1'],
    ]);</code></pre>
<h2 id="%E6%9B%B4%E6%96%B0%E6%9F%90%E4%B8%AA%E5%AD%97%E6%AE%B5%E7%9A%84%E5%80%BC%EF%BC%9A" class="calibre15">更新某个字段的值：</h2>
<pre class="calibre21"><code class="calibre22">Db::table('think_user')
    -&gt;where('id',1)
    -&gt;setField('name', 'thinkphp');</code></pre>
<blockquote class="calibre5">
<p class="calibre14">setField 方法返回影响数据的条数，没修改任何数据字段返回 0</p>
</blockquote>
<h2 id="%E8%87%AA%E5%A2%9E%E6%88%96%E8%87%AA%E5%87%8F%E4%B8%80%E4%B8%AA%E5%AD%97%E6%AE%B5%E7%9A%84%E5%80%BC" class="calibre15">自增或自减一个字段的值</h2>
<p class="calibre10"><code class="calibre7">setInc/setDec</code> 如不加第二个参数，默认值为1</p>
<pre class="calibre21"><code class="calibre22">// score 字段加 1
Db::table('think_user')
    -&gt;where('id', 1)
    -&gt;setInc('score');
// score 字段加 5
Db::table('think_user')
    -&gt;where('id', 1)
    -&gt;setInc('score', 5);
// score 字段减 1
Db::table('think_user')
    -&gt;where('id', 1)
    -&gt;setDec('score');
// score 字段减 5
Db::table('think_user')
    -&gt;where('id', 1)
    -&gt;setDec('score', 5);</code></pre>
<h2 id="%E5%BB%B6%E8%BF%9F%E6%9B%B4%E6%96%B0" class="calibre15">延迟更新</h2>
<p class="calibre10"><code class="calibre7">setInc/setDec</code>支持延时更新，如果需要延时更新则传入第三个参数<br class="calibre16"/>
下例中延时10秒，给<code class="calibre7">score</code>字段增加1</p>
<pre class="calibre21"><code class="calibre22">Db::table('think_user')-&gt;where('id', 1)-&gt;setInc('score', 1, 10);</code></pre>
<blockquote class="calibre5">
<p class="calibre14">setInc/setDec 方法返回影响数据的条数</p>
</blockquote>
<h2 id="%E5%8A%A9%E6%89%8B%E5%87%BD%E6%95%B0-2" class="calibre15">助手函数</h2>
<pre class="calibre21"><code class="calibre22">// 更新数据表中的数据
db('user')-&gt;where('id',1)-&gt;update(['name' =&gt; 'thinkphp']);
// 更新某个字段的值
db('user')-&gt;where('id',1)-&gt;setField('name','thinkphp');
// 自增 score 字段
db('user')-&gt;where('id', 1)-&gt;setInc('score');
// 自减 score 字段
db('user')-&gt;where('id', 1)-&gt;setDec('score');</code></pre>
<h2 id="%E5%BF%AB%E6%8D%B7%E6%9B%B4%E6%96%B0%EF%BC%88%60v5.0.5%2B%60%EF%BC%89" class="calibre15">快捷更新（<code class="calibre7">V5.0.5+</code>）</h2>
<p class="calibre10"><code class="calibre7">V5.0.5+</code>以上版本封装的<code class="calibre7">data</code>、<code class="calibre7">inc</code>、<code class="calibre7">dec</code>和<code class="calibre7">exp</code>方法属于链式操作方法，可以配合<code class="calibre7">update</code>使用。</p>
<p class="calibre10">下面举个例子说明用法：</p>
<pre class="calibre21"><code class="calibre22">Db::table('data')
    -&gt;where('id',1)
    -&gt;inc('read')
    -&gt;dec('score',3)
    -&gt;exp('name','UPPER(name)')
    -&gt;update();</code></pre>
</div>
	
</body></html>
