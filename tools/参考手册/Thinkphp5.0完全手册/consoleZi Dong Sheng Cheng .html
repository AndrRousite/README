<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-CN" xml:lang="zh-CN">
  <head>
    <title>自动生成目录结构</title>
    <meta content="IE=edge" http-equiv="X-UA-Compatible"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="page_styles.css" rel="stylesheet" type="text/css"/>
</head>
  <body class="calibre">
        <h1 class="book-title" id="calibre_toc_207">自动生成目录结构</h1>
<div class="book-content">
    <p class="calibre10">ThinkPHP5.0 具备自动创建功能，可以用来自动生成需要的模块及目录结构和文件等，自动生成主要调用<code class="calibre7">\think\Build</code>类库。</p>
<h2 id="%E7%94%9F%E6%88%90%E8%A7%84%E5%88%99%E5%AE%9A%E4%B9%89" class="calibre15">生成规则定义</h2>
<p class="calibre10">首先需要定义一个用于自动生成的规则定义文件，通常命名为<code class="calibre7">build.php</code>。</p>
<p class="calibre10">默认的框架的根目录下面自带了一个<code class="calibre7">build.php</code>示例参考文件，内容如下：</p>
<pre class="calibre21"><code class="calibre22">return [
    // 生成运行时目录
    '__file__' =&gt; ['common.php'],

    // 定义index模块的自动生成
    'index'    =&gt; [
        '__file__'   =&gt; ['common.php'],
        '__dir__'    =&gt; ['behavior', 'controller', 'model', 'view'],
        'controller' =&gt; ['Index', 'Test', 'UserType'],
        'model'      =&gt; [],
        'view'       =&gt; ['index/index'],
    ],
    // 。。。 其他更多的模块定义
];</code></pre>
<p class="calibre10">可以给每个模块定义需要自动生成的文件和目录，以及MVC类。</p>
<ul class="calibre23"><li class="calibre20"><code class="calibre7">__dir__</code> 表示生成目录（支持多级目录）</li>
<li class="calibre20"><code class="calibre7">__file__</code> 表示生成文件（不定义默认会生成 config.php 文件）</li>
<li class="calibre20">controller 表示生成controller类</li>
<li class="calibre20">model表示生成model类</li>
<li class="calibre20">view表示生成html文件（支持子目录）</li>
</ul><p class="calibre10">自动生成以<code class="calibre7">APP_PATH</code>为起始目录，<code class="calibre7">__dir__</code> 和 <code class="calibre7">__file__</code> 表示需要自动创建目录和文件，其他的则表示为模块自动生成。</p>
<p class="calibre10">模块的自动生成则以 <code class="calibre7">APP_PATH.'模块名/'</code> 为起始目录。</p>
<p class="calibre10">并且会自动生成模块的默认的Index访问控制器文件用于显示框架的欢迎页面。</p>
<p class="calibre10">我们还可以在<code class="calibre7">APP_PATH</code>目录下面自动生成其它的文件和目录，或者增加多个模块的自动生成，例如：</p>
<pre class="calibre21"><code class="calibre22">return [
    '__file__'  =&gt; ['hello.php','test.php'],
    // 定义index模块的自动生成
    'index'   =&gt; [
        '__file__'   =&gt; ['tags.php', 'user.php', 'hello.php'],
        '__dir__'    =&gt; ['behavior', 'controller', 'model', 'view'],
        'controller' =&gt; ['Index', 'Test', 'UserType'],
        'model'      =&gt; [],
        'view'       =&gt; ['index/index'],
    ],    
    // 定义test模块的自动生成
    'test'=&gt;[
        '__dir__'   =&gt;  ['behavior','controller','model','widget'],
        'controller'=&gt;  ['Index','Test','UserType'],
        'model'     =&gt;   ['User','UserType'],
        'view'      =&gt;  ['index/index','index/test'],
    ],
 ];</code></pre>
<h2 id="%E5%91%BD%E4%BB%A4%E8%A1%8C%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90" class="calibre15">命令行自动生成</h2>
<p class="calibre10">我们通过控制台来完成自动生成，切换到命令行，在应用的根目录输入下面命令：</p>
<pre class="calibre21"><code class="calibre22">&gt;php think build</code></pre>
<p class="calibre10">如果看到输出</p>
<pre class="calibre21"><code class="calibre22">Successed</code></pre>
<p class="calibre10">则表示自动生成成功。</p>
<p class="calibre10">默认会读取应用目录<code class="calibre7">application</code>下面的<code class="calibre7">build.php</code> 作为自动生成的定义文件，如果你的定义文件位置不同，则需要使用<code class="calibre7">--config</code>参数指定如下：</p>
<pre class="calibre21"><code class="calibre22">&gt;php think build --config build.php</code></pre>
<p class="calibre10">表示读取根目录下的<code class="calibre7">build.php</code>文件。</p>
<p class="calibre10">生成模块指令</p>
<pre class="calibre21"><code class="calibre22">&gt;php think build --module test</code></pre>
<p class="calibre10">表示自动生成<code class="calibre7">test</code>模块。</p>
<h2 id="%E6%B7%BB%E5%8A%A0%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%E4%BB%A3%E7%A0%81" class="calibre15">添加自动生成代码</h2>
<p class="calibre10">如果你不习惯命令行操作，也可以直接调用<code class="calibre7">\think\Build</code>类的方法进行自动生成，例如：</p>
<pre class="calibre21"><code class="calibre22">// 定义应用目录
define('APP_PATH', __DIR__ . '/../application/');
// 加载框架引导文件
require __DIR__ . '/../thinkphp/start.php';
// 读取自动生成定义文件
$build = include 'build.php';
// 运行自动生成
\think\Build::run($build);</code></pre>
<p class="calibre10"><code class="calibre7">run</code>方法第二个参数用于指定要生成的应用类库的命名空间，默认是<code class="calibre7">app</code>，第三个参数是设置是否需要使用类后缀。<br class="calibre16"/>
例如：</p>
<pre class="calibre21"><code class="calibre22">// 定义应用目录
define('APP_PATH', __DIR__ . '/../application/');
// 加载框架引导文件
require __DIR__ . '/../thinkphp/start.php';
// 读取自动生成定义文件
$build = include 'build.php';
// 运行自动生成
\think\Build::run($build,'application',true);</code></pre>
<p class="calibre10">可以不依赖自动生成文件，直接使用默认目录生成模块，例如：</p>
<pre class="calibre21"><code class="calibre22">// 定义应用目录
define('APP_PATH', __DIR__ . '/../application/');
// 加载框架引导文件
require __DIR__ . '/../thinkphp/start.php';
// 自动生成admin模块
\think\Build::module('admin');</code></pre>
<p class="calibre10"><code class="calibre7">module</code>方法第二个参数和第三个参数的用法和<code class="calibre7">run</code>方法一样。</p>
</div>
	
</body></html>
