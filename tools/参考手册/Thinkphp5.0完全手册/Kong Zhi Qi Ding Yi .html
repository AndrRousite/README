<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-CN" xml:lang="zh-CN">
  <head>
    <title>控制器定义</title>
    <meta content="IE=edge" http-equiv="X-UA-Compatible"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="page_styles.css" rel="stylesheet" type="text/css"/>
</head>
  <body class="calibre">
        <h1 class="book-title" id="calibre_toc_44">控制器定义</h1>
<div class="book-content">
    <p class="calibre10">ThinkPHP V5.0的控制器定义比较灵活，可以无需继承任何的基础类，也可以继承官方封装的<code class="calibre7">\think\Controller</code>类或者其他的控制器类。</p>
<h2 id="%E6%8E%A7%E5%88%B6%E5%99%A8%E5%AE%9A%E4%B9%89" class="calibre15">控制器定义</h2>
<p class="calibre10">一个典型的控制器类定义如下：</p>
<pre class="calibre21"><code class="calibre22">namespace app\index\controller;

class Index 
{
    public function index()
    {
        return 'index';
    }
}</code></pre>
<p class="calibre10">控制器类文件的实际位置是 </p>
<pre class="calibre21"><code class="calibre22">application\index\controller\Index.php</code></pre>
<p class="calibre10">控制器类可以无需继承任何类，命名空间默认以<code class="calibre7">app</code>为根命名空间。</p>
<p class="calibre10">控制器的根命名空间可以设置，例如我们在应用配置文件中修改：</p>
<pre class="calibre21"><code class="calibre22">// 修改应用类库命名空间
'app_namespace' =&gt; 'application',</code></pre>
<p class="calibre10">则实际的控制器类应该更改定义如下：</p>
<pre class="calibre21"><code class="calibre22">namespace application\index\controller;

class Index 
{
    public function index()
    {
        return 'index';
    }
}</code></pre>
<blockquote class="calibre5">
<p class="calibre14">只是命名空间改变了，但实际的文件位置和文件名并没有改变。</p>
</blockquote>
<p class="calibre10">使用该方式定义的控制器类，如果要在控制器里面渲染模板，可以使用</p>
<pre class="calibre21"><code class="calibre22">namespace app\index\controller;

use think\View;

class Index 
{
    public function index()
    {
        $view = new View();
        return $view-&gt;fetch('index');
    }
}</code></pre>
<p class="calibre10">或者直接使用view助手函数渲染模板输出，例如：</p>
<pre class="calibre21"><code class="calibre22">namespace app\index\controller;

class Index 
{
    public function index()
    {
        return view('index');
    }
}</code></pre>
<p class="calibre10">如果继承了<code class="calibre7">think\Controller</code>类的话，可以直接调用<code class="calibre7">think\View</code>及<code class="calibre7">think\Request</code>类的方法，例如：</p>
<pre class="calibre21"><code class="calibre22">namespace app\index\controller;

use think\Controller;

class Index extends Controller
{
    public function index()
    {
        // 获取包含域名的完整URL地址
        $this-&gt;assign('domain',$this-&gt;request-&gt;url(true));
        return $this-&gt;fetch('index');
    }
}</code></pre>
<h2 id="%E6%B8%B2%E6%9F%93%E8%BE%93%E5%87%BA" class="calibre15">渲染输出</h2>
<p class="calibre10">默认情况下，控制器的输出全部采用<code class="calibre7">return</code>的方式，无需进行任何的手动输出，系统会自动完成渲染内容的输出。</p>
<p class="calibre10">下面都是有效的输出方式：</p>
<pre class="calibre21"><code class="calibre22">namespace app\index\controller;

class Index 
{
    public function hello()
    {
        return 'hello,world!';
    }

    public function json()
    {
        return json_encode($data);
    }

    public function read()
    {
        return view();
    }

}</code></pre>
<blockquote class="calibre5">
<p class="calibre14">控制器一般不需要任何输出，直接return即可。</p>
</blockquote>
<h2 id="%E8%BE%93%E5%87%BA%E8%BD%AC%E6%8D%A2" class="calibre15">输出转换</h2>
<p class="calibre10">默认情况下，控制器的返回输出不会做任何的数据处理，但可以设置输出格式，并进行自动的数据转换处理，前提是控制器的输出数据必须采用<code class="calibre7">return</code>的方式返回。</p>
<p class="calibre10">如果控制器定义为：</p>
<pre class="calibre21"><code class="calibre22">namespace app\index\controller;

class Index 
{
    public function hello()
    {
        return 'hello,world!';
    }

    public function data()
    {
        return ['name'=&gt;'thinkphp','status'=&gt;1];
    }

}</code></pre>
<p class="calibre10">当我们设置输出数据格式为JSON：</p>
<pre class="calibre21"><code class="calibre22">// 默认输出类型
'default_return_type'   =&gt; 'json',</code></pre>
<p class="calibre10">我们访问</p>
<pre class="calibre21"><code class="calibre22">http://localhost/index.php/index/Index/hello
http://localhost/index.php/index/Index/data</code></pre>
<p class="calibre10">输出的结果变成：</p>
<pre class="calibre21"><code class="calibre22">"hello,world!"
{"name":"thinkphp","status":1}</code></pre>
<p class="calibre10">默认情况下，控制器在ajax请求会对返回类型自动转换，默认为json</p>
<p class="calibre10">如果我们控制器定义</p>
<pre class="calibre21"><code class="calibre22">namespace app\index\controller;

class Index 
{
    public function data()
    {
        return ['name'=&gt;'thinkphp','status'=&gt;1];
    }

}</code></pre>
<p class="calibre10">我们访问</p>
<pre class="calibre21"><code class="calibre22">http://localhost/index.php/index/Index/data</code></pre>
<p class="calibre10">输出的结果变成：</p>
<pre class="calibre21"><code class="calibre22">{"name":"thinkphp","status":1}</code></pre>
<p class="calibre10">当我们设置输出数据格式为html：</p>
<pre class="calibre21"><code class="calibre22">// 默认输出类型
'default_ajax_return'   =&gt; 'html',</code></pre>
<p class="calibre10">这种情况下ajax请求不会对返回内容进行转换</p>
</div>
	
</body></html>
