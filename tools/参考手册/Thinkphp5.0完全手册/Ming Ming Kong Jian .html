<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-CN" xml:lang="zh-CN">
  <head>
    <title>命名空间</title>
    <meta content="IE=edge" http-equiv="X-UA-Compatible"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="page_styles.css" rel="stylesheet" type="text/css"/>
</head>
  <body class="calibre">
        <h1 class="book-title" id="calibre_toc_12">命名空间</h1>
<div class="book-content">
    <h2 id="%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4-1" class="calibre15">命名空间</h2>
<p class="calibre10"><code class="calibre7">ThinkPHP5</code>采用命名空间方式定义和自动加载类库文件，有效的解决了多模块和<code class="calibre7">Composer</code>类库之间的命名空间冲突问题，并且实现了更加高效的类库自动加载机制。</p>
<blockquote class="calibre5">
<p class="calibre14">如果不清楚命名空间的基本概念，可以参考PHP手册：<a href="http://www.php.net/manual/zh/language.namespaces.php" class="pcalibre calibre13">PHP命名空间</a></p>
<p class="calibre14">特别注意的是，如果你需要调用PHP内置的类库，或者第三方没有使用命名空间的类库，记得在实例化类库的时候加上 <code class="calibre7">\</code>，例如：</p>
<pre class="calibre24"><code class="calibre22">// 错误的用法
$class = new stdClass();
$xml  =  new SimpleXmlElement($xmlstr);
// 正确的用法
$class = new \stdClass();
$xml  =  new \SimpleXmlElement($xmlstr);</code></pre>
</blockquote>
<p class="calibre10">在ThinkPHP<code class="calibre7">5.0</code>中，只需要给类库正确定义所在的命名空间，并且命名空间的路径与类库文件的目录一致，那么就可以实现类的自动加载，从而实现真正的惰性加载。</p>
<p class="calibre10">例如，<code class="calibre7">\think\cache\driver\File</code>类的定义为：</p>
<pre class="calibre21"><code class="calibre22">namespace think\cache\driver;

class File 
{
}</code></pre>
<p class="calibre10">如果我们实例化该类的话，应该是：</p>
<pre class="calibre21"><code class="calibre22">$class = new \think\cache\driver\File();</code></pre>
<p class="calibre10">系统会自动加载该类对应路径的类文件，其所在的路径是 <code class="calibre7">thinkphp/library/think/cache/driver/File.php</code>。</p>
<blockquote class="calibre5">
<p class="calibre14">5.0默认的目录规范是小写，类文件命名是驼峰法，并且首字母大写。</p>
</blockquote>
<p class="calibre10">原则上，可以支持驼峰法命名的目录，只要命名空间定义和目录一致即可，例如：</p>
<p class="calibre10">我们实例化</p>
<pre class="calibre21"><code class="calibre22">$class = new \Think\Cache\Driver\File();</code></pre>
<p class="calibre10">系统则会自动加载 <code class="calibre7">thinkphp/library/Think/Cache/Driver/File.php</code>文件。</p>
<h2 id="%E6%A0%B9%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%EF%BC%88%E7%B1%BB%E5%BA%93%E5%8C%85%EF%BC%89" class="calibre15">根命名空间（类库包）</h2>
<p class="calibre10">根命名空间是一个关键的概念，以上面的<code class="calibre7">\think\cache\driver\File</code>类为例，<code class="calibre7">think</code>就是一个根命名空间，其对应的初始命名空间目录就是系统的类库目录（<code class="calibre7">thinkphp/library/think</code>），我们可以简单的理解一个根命名空间对应了一个类库包。</p>
<table class="calibre25"><thead class="calibre26"><tr class="calibre27"><th class="calibre28">系统内置的几个根命名空间（类库包）如下：</th>
<th class="calibre28">名称</th>
<th class="calibre28">描述</th>
<th class="calibre28">类库目录</th>
</tr></thead><tbody class="calibre29"><tr class="calibre27"><td class="pcalibre1 calibre30">think</td>
<td class="pcalibre1 calibre31">系统核心类库</td>
<td class="calibre32 pcalibre1">thinkphp/library/think</td>
</tr><tr class="calibre27"><td class="pcalibre1 calibre31">traits</td>
<td class="pcalibre1 calibre31">系统Trait类库</td>
<td class="pcalibre1 calibre31">thinkphp/library/traits</td>
</tr><tr class="calibre27"><td class="pcalibre1 calibre31">app</td>
<td class="pcalibre1 calibre31">应用类库</td>
<td class="calibre33 pcalibre1">application</td>
</tr></tbody></table><p class="calibre10">如果需要增加新的根命名空间，有两种方式：注册新的根命名空间或者放入<code class="calibre7">EXTEND_PATH</code>目录（自动注册）。</p>
<blockquote class="danger">
<p class="calibre14">请注意本手册中的示例代码为了简洁，如无指定类库的命名空间的话，都表示指的是<code class="calibre7">think</code>命名空间，例如下面的代码：</p>
<pre class="calibre21"><code class="calibre22">Route::get('hello','index/hello');</code></pre>
<p class="calibre14">请自行添加 <code class="calibre7">use think\Route</code>或者使用 </p>
<pre class="calibre24"><code class="calibre22">\think\Route::get('hello','index/hello');</code></pre>
</blockquote>
<h2 id="%E8%87%AA%E5%8A%A8%E6%B3%A8%E5%86%8C" class="calibre15">自动注册</h2>
<p class="calibre10">我们只需要把自己的类库包目录放入<code class="calibre7">EXTEND_PATH</code>目录（默认为<code class="calibre7">extend</code>，可配置），就可以自动注册对应的命名空间，例如：</p>
<p class="calibre10">我们在<code class="calibre7">extend</code>目录下面新增一个<code class="calibre7">my</code>目录，然后定义一个<code class="calibre7">\my\Test</code>类（ 类文件位于<code class="calibre7">extend/my/Test.php</code>）如下：</p>
<pre class="calibre21"><code class="calibre22">namespace my;

class Test 
{
    public function sayHello()
    {
        echo 'hello';
    }
}</code></pre>
<p class="calibre10">我们就可以直接实例化和调用：</p>
<pre class="calibre21"><code class="calibre22">$Test = new \my\Test();
$Test-&gt;sayHello();</code></pre>
<p class="calibre10">如果我们在应用入口文件中重新定义了<code class="calibre7">EXTEND_PATH</code>常量的话，还可以改变<code class="calibre7">\my\Test</code>类文件的位置，例如：</p>
<pre class="calibre21"><code class="calibre22">define('EXTEND_PATH','../vendor/');</code></pre>
<p class="calibre10">那么<code class="calibre7">\my\Test</code>类文件的位置就变成了<code class="calibre7">/vendor/my/File.php</code>。</p>
<h2 id="%E6%89%8B%E5%8A%A8%E6%B3%A8%E5%86%8C" class="calibre15">手动注册</h2>
<p class="calibre10">也可以通过手动注册的方式注册新的根命名空间，例如：</p>
<p class="calibre10">在应用入口文件中添加下面的代码：</p>
<pre class="calibre21"><code class="calibre22">\think\Loader::addNamespace('my','../application/extend/my/');</code></pre>
<p class="calibre10">如果要同时注册多个根命名空间，可以使用：</p>
<pre class="calibre21"><code class="calibre22">\think\Loader::addNamespace([
    'my'  =&gt; '../application/extend/my/',
    'org' =&gt; '../application/extend/org/',
]);</code></pre>
<p class="calibre10">也可以直接在应用的配置文件中添加配置，系统会在应用执行的时候自动注册。</p>
<pre class="calibre21"><code class="calibre22">'root_namespace' =&gt; [
    'my'  =&gt; '../application/extend/my/',
    'org' =&gt; '../application/extend/org/',
]</code></pre>
<h2 id="%E5%BA%94%E7%94%A8%E7%B1%BB%E5%BA%93%E5%8C%85" class="calibre15">应用类库包</h2>
<p class="calibre10">为了避免和<code class="calibre7">Composer</code>自动加载的类库存在冲突 ，应用类库的命名空间的根都统一以<code class="calibre7">app</code>命名，例如：</p>
<pre class="calibre21"><code class="calibre22">namespace app\index\model;

class User extends \think\Model
{
}</code></pre>
<p class="calibre10">其类文件位于 <code class="calibre7">application/index/model/User.php</code>。</p>
<pre class="calibre21"><code class="calibre22">namespace app\admin\event;

class User 
{
}</code></pre>
<p class="calibre10">其类文件位于 <code class="calibre7">application/admin/event/User.php</code>。</p>
<p class="calibre10">如果觉得<code class="calibre7">app</code>根命名空间不合适或者有冲突，可以在应用配置文件中修改：</p>
<pre class="calibre21"><code class="calibre22">'app_namespace' =&gt;  'application',</code></pre>
<p class="calibre10">定义后，应用类库的命名空间改为：</p>
<pre class="calibre21"><code class="calibre22">namespace application\index\model;

class User extends \think\Model
{
}</code></pre>
<h2 id="%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E5%88%AB%E5%90%8D" class="calibre15">命名空间别名</h2>
<p class="calibre10">框架允许给命名空间定义别名，例如：</p>
<pre class="calibre21"><code class="calibre22">namespace app\index\model;

use think\Model;

class User extends Model
{
}</code></pre>
<p class="calibre10">原来在控制器里面调用方式为：</p>
<pre class="calibre21"><code class="calibre22">namespace app\index\controller;

use app\index\model\User;

class Index
{
    public function index()
    {
        $user = new User();
    }
}</code></pre>
<p class="calibre10">如果我们在应用公共文件中注册命名空间别名如下：</p>
<pre class="calibre21"><code class="calibre22">\think\Loader::addNamespaceAlias('model','app\index\model');</code></pre>
<p class="calibre10">那么，上面的控制器代码就可以更改为：</p>
<pre class="calibre21"><code class="calibre22">namespace app\index\controller;

use model\User;

class Index
{
    public function index()
    {
        $user = new User();
    }
}</code></pre>
<blockquote class="danger">
<h3 id="%E6%9C%AC%E6%89%8B%E5%86%8C%E5%90%8E%E7%BB%AD%E7%9A%84%E7%AB%A0%E8%8A%82%EF%BC%8C%E5%9D%87%E5%BB%BA%E7%AB%8B%E5%9C%A8%E4%BD%A0%E5%B7%B2%E7%BB%8F%E4%BA%86%E8%A7%A3php%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E7%9A%84%E5%9F%BA%E7%A1%80%E4%B9%8B%E4%B8%8A%EF%BC%8C%E5%A6%82%E6%9E%9C%E4%B8%8D%E6%8E%8C%E6%8F%A1%E8%AF%B7%E8%87%AA%E8%A1%8C%E8%A1%A5%E5%85%85php%E5%9F%BA%E7%A1%80%EF%BC%8C%E5%90%A6%E5%88%99%E4%BD%A0%E5%9C%A8%E5%90%8E%E7%BB%AD%E7%9A%84%E6%96%87%E6%A1%A3%E5%92%8Cthinkphp5.0%E7%9A%84%E5%AD%A6%E4%B9%A0%E8%BF%87%E7%A8%8B%E4%B8%AD%EF%BC%8C%E5%AF%B9%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E7%9A%84%E7%BC%BA%E4%B9%8F%E7%90%86%E8%A7%A3%E4%BC%9A%E6%88%90%E4%B8%BA%E4%BD%A0%E6%9C%80%E5%A4%A7%E7%9A%84%E5%AD%A6%E4%B9%A0%E9%9A%9C%E7%A2%8D%E3%80%82" class="calibre17">本手册后续的章节，均建立在你已经了解PHP命名空间的基础之上，如果不掌握请自行补充PHP基础，否则你在后续的文档和ThinkPHP5.0的学习过程中，对命名空间的缺乏理解会成为你最大的学习障碍。</h3>
</blockquote>
</div>
	
</body></html>
