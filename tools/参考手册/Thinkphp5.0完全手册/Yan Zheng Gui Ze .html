<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-CN" xml:lang="zh-CN">
  <head>
    <title>验证规则</title>
    <meta content="IE=edge" http-equiv="X-UA-Compatible"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="page_styles.css" rel="stylesheet" type="text/css"/>
</head>
  <body class="calibre">
        <h1 class="book-title" id="calibre_toc_170">验证规则</h1>
<div class="book-content">
    <table class="calibre25"><thead class="calibre26"><tr class="calibre27"><th class="calibre28">版本</th>
<th class="calibre28">新增功能</th>
</tr></thead><tbody class="calibre29"><tr class="calibre27"><td class="pcalibre1 calibre30">5.0.4</td>
<td class="calibre34 pcalibre1">支持传入<code class="calibre7">field</code>参数批量设置验证字段的描述信息</td>
</tr></tbody></table><h2 id="%E8%AE%BE%E7%BD%AE%E8%A7%84%E5%88%99" class="calibre15">设置规则</h2>
<p class="calibre10">可以在实例化<code class="calibre7">Validate</code>类的时候传入验证规则，例如：</p>
<pre class="calibre21"><code class="calibre22">$rules = [
    'name'  =&gt; 'require|max:25',
    'age'   =&gt; 'number|between:1,120',
];
$validate = new Validate($rules);</code></pre>
<p class="calibre10">也可以使用<code class="calibre7">rule</code>方法动态添加规则，例如：</p>
<pre class="calibre21"><code class="calibre22">$rules = [
    'name'  =&gt; 'require|max:25',
    'age'   =&gt; 'number|between:1,120',
];
$validate = new Validate($rules);
$validate-&gt;rule('zip', '/^\d{6}$/');
$validate-&gt;rule([
    'email'   =&gt; 'email',
]);</code></pre>
<h2 id="%E8%A7%84%E5%88%99%E5%AE%9A%E4%B9%89" class="calibre15">规则定义</h2>
<p class="calibre10">规则定义支持下面两种方式：</p>
<pre class="calibre21"><code class="calibre22">$rules = [
    'name'  =&gt; 'require|max:25',
    'age'   =&gt; 'number|between:1,120',
];
$validate = new Validate($rules);</code></pre>
<p class="calibre10">对于一个字段可以设置多个验证规则，使用<code class="calibre7">|</code>分割。</p>
<p class="calibre10">或者采用数组方式定义多个规则（适用于你的验证规则中有<code class="calibre7">|</code>的情况）</p>
<pre class="calibre21"><code class="calibre22">$rules = [
    'name'  =&gt; ['require','max'=&gt;25],
    'age'   =&gt; ['number','between'=&gt;'1,120'],
];
$validate = new Validate($rules);</code></pre>
<h2 id="%E5%B1%9E%E6%80%A7%E5%AE%9A%E4%B9%89" class="calibre15">属性定义</h2>
<p class="calibre10">通常情况下，我们实际在定义验证类的时候，可以通过属性的方式直接定义验证规则等信息，例如：</p>
<pre class="calibre21"><code class="calibre22">namespace app\index\validate;

use think\Validate;

class User extends Validate
{
    protected $rule =   [
        'name'  =&gt; 'require|max:25',
        'age'   =&gt; 'number|between:1,120',
        'email' =&gt; 'email',    
    ];

    protected $message  =   [
        'name.require' =&gt; '名称必须',
        'name.max'     =&gt; '名称最多不能超过25个字符',
        'age.number'   =&gt; '年龄必须是数字',
        'age.between'  =&gt; '年龄只能在1-120之间',
        'email'        =&gt; '邮箱格式错误',    
    ];

}</code></pre>
<h2 id="%E9%AA%8C%E8%AF%81%E6%95%B0%E6%8D%AE" class="calibre15">验证数据</h2>
<p class="calibre10">下面是一个典型的验证数据的例子：</p>
<pre class="calibre21"><code class="calibre22">$rule = [
    'name'  =&gt; 'require|max:25',
    'age'   =&gt; 'number|between:1,120',
    'email' =&gt; 'email',
];

$msg = [
    'name.require' =&gt; '名称必须',
    'name.max'     =&gt; '名称最多不能超过25个字符',
    'age.number'   =&gt; '年龄必须是数字',
    'age.between'  =&gt; '年龄只能在1-120之间',
    'email'        =&gt; '邮箱格式错误',
];

$data = [
    'name'  =&gt; 'thinkphp',
    'age'   =&gt; 10,
    'email' =&gt; 'thinkphp@qq.com',
];

$validate = new Validate($rule, $msg);
$result   = $validate-&gt;check($data);</code></pre>
<p class="calibre10">如果需要批量验证，可以使用：</p>
<pre class="calibre21"><code class="calibre22">$validate = new Validate($rule, $msg);
$result   = $validate-&gt;batch()-&gt;check($data);</code></pre>
<blockquote class="calibre5">
<p class="calibre14">批量验证如果验证不通过，返回的是一个错误信息的数组。</p>
</blockquote>
<p class="calibre10">如果你定义了User验证器类的话，可以使用下面的验证代码：</p>
<pre class="calibre21"><code class="calibre22">$data = [
    'name'  =&gt; 'thinkphp',
    'age'   =&gt; 10,
    'email' =&gt; 'thinkphp@qq.com',
];
$validate = Loader::validate('User');
if(!$validate-&gt;check($data)){
    dump($validate-&gt;getError());
}</code></pre>
<h2 id="%E9%97%AD%E5%8C%85%E5%87%BD%E6%95%B0%E9%AA%8C%E8%AF%81" class="calibre15">闭包函数验证</h2>
<p class="calibre10">可以对某个字段使用闭包验证，例如：</p>
<pre class="calibre21"><code class="calibre22">$validate = new \think\Validate([
    'name'  =&gt; function($value,$rule) { 
        return $rule==$value ? true : false;
    },
]);</code></pre>
<h2 id="%E8%87%AA%E5%AE%9A%E4%B9%89%E9%AA%8C%E8%AF%81%E8%A7%84%E5%88%99" class="calibre15">自定义验证规则</h2>
<p class="calibre10">系统内置了一些常用的规则，如果还不够用，可以自己扩展验证规则。</p>
<p class="calibre10">如果使用了验证器的话，可以直接在验证器类添加自己的验证方法，例如：</p>
<pre class="calibre21"><code class="calibre22">namespace app\index\validate;

use think\Validate;

class User extends Validate
{
    protected $rule = [
        'name'  =&gt;  'checkName:thinkphp',
        'email' =&gt;  'email',
    ];

    protected $message = [
        'name'  =&gt;  '用户名必须',
        'email' =&gt;  '邮箱格式错误',
    ];

    // 自定义验证规则
    protected function checkName($value,$rule,$data)
    {
        return $rule == $value ? true : '名称错误';
    }
}</code></pre>
<p class="calibre10">验证方法可以传入的参数共有<code class="calibre7">5</code>个（后面三个根据情况选用），依次为：</p>
<ul class="calibre23"><li class="calibre20">验证数据</li>
<li class="calibre20">验证规则</li>
<li class="calibre20">全部数据（数组）</li>
<li class="calibre20">字段名</li>
<li class="calibre20">字段描述</li>
</ul><blockquote class="calibre5">
<p class="calibre14">并且需要注意的是，自定义的验证规则方法名不能和已有的规则冲突。</p>
</blockquote>
<p class="calibre10">接下来，就可以这样进行验证：</p>
<pre class="calibre21"><code class="calibre22">$validate = Loader::validate('User');
if(!$validate-&gt;check($data)){
    dump($validate-&gt;getError());
}</code></pre>
<p class="calibre10">如果没有使用验证器类，则支持使用<code class="calibre7">extend</code>方法扩展验证规则，例如：</p>
<pre class="calibre21"><code class="calibre22">$validate = new Validate(['name' =&gt; 'checkName:1']);
$validate-&gt;extend('checkName', function ($value, $rule) {
    return $rule == $value ? true : '名称错误';
});
$data   = ['name' =&gt; 1];
$result = $validate-&gt;check($data);</code></pre>
<p class="calibre10">支持批量注册验证规则，例如：</p>
<pre class="calibre21"><code class="calibre22">$validate = new Validate(['name' =&gt; 'checkName:1']);
$validate-&gt;extend([
    'checkName'=&gt; function ($value, $rule) {
    return $rule == $value ? true : '名称错误';
},
    'checkStatus'=&gt; [$this,'checkStatus']
]);
$data   = ['name' =&gt; 1];
$result = $validate-&gt;check($data);</code></pre>
<h3 id="%E8%AE%BE%E7%BD%AE%E5%AD%97%E6%AE%B5%E4%BF%A1%E6%81%AF" class="calibre17">设置字段信息</h3>
<p class="calibre10"><code class="calibre7">V5.0.4+</code>版本开始，验证类的架构方法支持传入<code class="calibre7">field</code>参数批量设置字段的描述信息，例如：</p>
<pre class="calibre21"><code class="calibre22">$rule = [
    'name'  =&gt; 'require|max:25',
    'age'   =&gt; 'number|between:1,120',
    'email' =&gt; 'email',
];

$field = [
    'name'  =&gt; '名称',
    'age'   =&gt; '年龄',
    'email' =&gt; '邮箱',    
];

$data = [
    'name'  =&gt; 'thinkphp',
    'age'   =&gt; 10,
    'email' =&gt; 'thinkphp@qq.com',
];

$validate = new Validate($rule, [] , $field);
$result   = $validate-&gt;check($data);</code></pre>
</div>
	
</body></html>
