<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-CN" xml:lang="zh-CN">
  <head>
    <title>cache</title>
    <meta content="IE=edge" http-equiv="X-UA-Compatible"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="page_styles.css" rel="stylesheet" type="text/css"/>
</head>
  <body class="calibre">
        <h1 class="book-title">cache</h1>
<div class="book-content">
    <p class="calibre10">cache方法用于查询缓存操作，也是连贯操作方法之一。</p>
<p class="calibre10"><strong class="calibre12">cache</strong>可以用于<code class="calibre7">select</code>、<code class="calibre7">find</code>、<code class="calibre7">value</code>和<code class="calibre7">column</code>方法，以及其衍生方法，使用<code class="calibre7">cache</code>方法后，在缓存有效期之内不会再次进行数据库查询操作，而是直接获取缓存中的数据，关于数据缓存的类型和设置可以参考缓存部分。</p>
<p class="calibre10">下面举例说明，例如，我们对find方法使用cache方法如下：</p>
<pre class="calibre21"><code class="calibre22">Db::table('think_user')-&gt;where('id=5')-&gt;cache(true)-&gt;find();</code></pre>
<p class="calibre10">第一次查询结果会被缓存，第二次查询相同的数据的时候就会直接返回缓存中的内容，而不需要再次进行数据库查询操作。</p>
<p class="calibre10">默认情况下， 缓存有效期是由默认的缓存配置参数决定的，但<code class="calibre7">cache</code>方法可以单独指定，例如：</p>
<pre class="calibre21"><code class="calibre22">Db::table('think_user')-&gt;cache(true,60)-&gt;find();
// 或者使用下面的方式 是等效的
Db::table('think_user')-&gt;cache(60)-&gt;find();</code></pre>
<p class="calibre10">表示对查询结果的缓存有效期60秒。</p>
<p class="calibre10">cache方法可以指定缓存标识：</p>
<pre class="calibre21"><code class="calibre22">Db::table('think_user')-&gt;cache('key',60)-&gt;find();</code></pre>
<blockquote class="calibre5">
<p class="calibre14">指定查询缓存的标识可以使得查询缓存更有效率。</p>
</blockquote>
<p class="calibre10">这样，在外部就可以通过<code class="calibre7">\think\Cache</code>类直接获取查询缓存的数据，例如：</p>
<pre class="calibre21"><code class="calibre22">$result = Db::table('think_user')-&gt;cache('key',60)-&gt;find();
$data = \think\Cache::get('key');</code></pre>
<p class="calibre10"><code class="calibre7">cache</code>方法支持设置缓存标签，例如：</p>
<pre class="calibre21"><code class="calibre22">Db::table('think_user')-&gt;cache('key',60,'tagName')-&gt;find();</code></pre>
<h2 id="%E7%BC%93%E5%AD%98%E8%87%AA%E5%8A%A8%E6%9B%B4%E6%96%B0" class="calibre15">缓存自动更新</h2>
<p class="calibre10">这里的缓存自动更新是指一旦数据更新或者删除后会自动清理缓存（下次获取的时候会自动重新缓存）。</p>
<p class="calibre10">当你删除或者更新数据的时候，可以使用cache方法手动更新（清除）缓存，例如：</p>
<pre class="calibre21"><code class="calibre22">Db::table('think_user')-&gt;cache('user_data')-&gt;select([1,3,5]);
Db::table('think_user')-&gt;cache('user_data')-&gt;update(['id'=&gt;1,'name'=&gt;'thinkphp']);
Db::table('think_user')-&gt;cache('user_data')-&gt;select([1,5]);</code></pre>
<p class="calibre10">最后查询的数据不会受第一条查询缓存的影响，确保查询和更新或者删除使用相同的缓存标识才能自动清除缓存。</p>
<p class="calibre10">如果使用<code class="calibre7">find</code>方法并且使用主键查询的情况，不需要指定缓存标识，会自动清理缓存，例如：</p>
<pre class="calibre21"><code class="calibre22">Db::table('think_user')-&gt;cache(true)-&gt;find(1);
Db::table('think_user')-&gt;update(['id'=&gt;1,'name'=&gt;'thinkphp']);
Db::table('think_user')-&gt;cache(true)-&gt;find(1);</code></pre>
<p class="calibre10">最后查询的数据会是更新后的数据。</p>
</div>
	
</body></html>
