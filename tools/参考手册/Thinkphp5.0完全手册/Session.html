<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-CN" xml:lang="zh-CN">
  <head>
    <title>Session</title>
    <meta content="IE=edge" http-equiv="X-UA-Compatible"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="page_styles.css" rel="stylesheet" type="text/css"/>
</head>
  <body class="calibre">
        <h1 class="book-title" id="calibre_toc_185">Session</h1>
<div class="book-content">
    <h2 id="%E6%A6%82%E8%BF%B0-5" class="calibre15">概述</h2>
<p class="calibre10">ThinkPHP采用<code class="calibre7">think\Session</code>类提供<code class="calibre7">Session</code>功能支持。</p>
<table class="calibre25"><thead class="calibre26"><tr class="calibre27"><th class="calibre28">版本</th>
<th class="calibre28">新增功能</th>
</tr></thead><tbody class="calibre29"><tr class="calibre27"><td class="pcalibre1 calibre30">5.0.5</td>
<td class="calibre32 pcalibre1">增加安全选项参数<code class="calibre7">secure</code>和<code class="calibre7">httponly</code></td>
</tr><tr class="calibre27"><td class="pcalibre1 calibre31">5.0.2</td>
<td class="calibre33 pcalibre1">增加<code class="calibre7">flash</code>方法和<code class="calibre7">flush</code>方法</td>
</tr></tbody></table><h2 id="session%E5%88%9D%E5%A7%8B%E5%8C%96" class="calibre15">Session初始化</h2>
<p class="calibre10">在ThinkPHP<code class="calibre7">5.0</code>中使用<code class="calibre7">\think\Session</code>类进行Session相关操作，Session会在第一次调用Session类的时候按照配置的参数自动初始化，例如，我们在应用配置中添加如下配置：</p>
<pre class="calibre21"><code class="calibre22">'session'                =&gt; [
    'prefix'         =&gt; 'think',
    'type'           =&gt; '',
    'auto_start'     =&gt; true,
],</code></pre>
<p class="calibre10">如果我们使用上述的session配置参数的话，无需任何操作就可以直接调用Session类的相关方法，例如：</p>
<pre class="calibre21"><code class="calibre22">Session::set('name','thinkphp');
Session::get('name');</code></pre>
<p class="calibre10">如果你应用下面的不同模块需要不同的session参数，那么可以在模块配置文件中重新设置：</p>
<pre class="calibre21"><code class="calibre22">'session'                =&gt; [
    'prefix'         =&gt; 'module',
    'type'           =&gt; '',
    'auto_start'     =&gt; true,
],</code></pre>
<p class="calibre10">或者调用init方法进行初始化：</p>
<pre class="calibre21"><code class="calibre22">Session::init([
    'prefix'         =&gt; 'module',
    'type'           =&gt; '',
    'auto_start'     =&gt; true,
]);</code></pre>
<blockquote class="calibre5">
<p class="calibre14">如果你没有使用Session类进行Session操作的话，例如直接操作<code class="calibre7">$_SESSION</code>,必须使用上面的方式手动初始化或者直接调用<code class="calibre7">session_start()</code>方法进行<code class="calibre7">session</code>初始化。</p>
</blockquote>
<h2 id="%E8%AE%BE%E7%BD%AE%E5%8F%82%E6%95%B0" class="calibre15">设置参数</h2>
<table class="calibre25"><thead class="calibre26"><tr class="calibre27"><th class="calibre28">默认支持的session设置参数包括：</th>
<th class="calibre28">参数</th>
<th class="calibre28">描述</th>
</tr></thead><tbody class="calibre29"><tr class="calibre27"><td class="pcalibre1 calibre30">type</td>
<td class="calibre32 pcalibre1">session类型</td>
</tr><tr class="calibre27"><td class="pcalibre1 calibre31">expire</td>
<td class="pcalibre1 calibre31">session过期时间</td>
</tr><tr class="calibre27"><td class="pcalibre1 calibre31">prefix</td>
<td class="pcalibre1 calibre31">session前缀</td>
</tr><tr class="calibre27"><td class="pcalibre1 calibre31">auto_start</td>
<td class="pcalibre1 calibre31">是否自动开启</td>
</tr><tr class="calibre27"><td class="pcalibre1 calibre31">use_trans_sid</td>
<td class="pcalibre1 calibre31">是否使用use_trans_sid</td>
</tr><tr class="calibre27"><td class="pcalibre1 calibre31">var_session_id</td>
<td class="pcalibre1 calibre31">请求session_id变量名</td>
</tr><tr class="calibre27"><td class="pcalibre1 calibre31">id</td>
<td class="pcalibre1 calibre31">session_id</td>
</tr><tr class="calibre27"><td class="pcalibre1 calibre31">name</td>
<td class="pcalibre1 calibre31">session_name</td>
</tr><tr class="calibre27"><td class="pcalibre1 calibre31">path</td>
<td class="pcalibre1 calibre31">session保存路径</td>
</tr><tr class="calibre27"><td class="pcalibre1 calibre31">domain</td>
<td class="pcalibre1 calibre31">session cookie_domain</td>
</tr><tr class="calibre27"><td class="pcalibre1 calibre31">use_cookies</td>
<td class="pcalibre1 calibre31">是否使用cookie</td>
</tr><tr class="calibre27"><td class="pcalibre1 calibre31">cache_limiter</td>
<td class="pcalibre1 calibre31">session_cache_limiter</td>
</tr><tr class="calibre27"><td class="pcalibre1 calibre31">cache_expire</td>
<td class="calibre33 pcalibre1">session_cache_expire</td>
</tr></tbody></table><blockquote class="calibre5">
<p class="calibre14">如果做了session驱动扩展，可能有些参数不一定有效。</p>
</blockquote>
<h2 id="%E5%9F%BA%E7%A1%80%E7%94%A8%E6%B3%95" class="calibre15">基础用法</h2>
<p class="calibre10">赋值</p>
<pre class="calibre21"><code class="calibre22">// 赋值（当前作用域）
Session::set('name','thinkphp');
// 赋值think作用域
Session::set('name','thinkphp','think');</code></pre>
<p class="calibre10">判断是否存在</p>
<pre class="calibre21"><code class="calibre22">// 判断（当前作用域）是否赋值
Session::has('name');
// 判断think作用域下面是否赋值
Session::has('name','think');</code></pre>
<p class="calibre10">取值</p>
<pre class="calibre21"><code class="calibre22">// 取值（当前作用域）
Session::get('name');
// 取值think作用域
Session::get('name','think');</code></pre>
<p class="calibre10">如果name的值不存在，返回<code class="calibre7">null</code>。</p>
<p class="calibre10">删除</p>
<pre class="calibre21"><code class="calibre22">// 删除（当前作用域）
Session::delete('name');
// 删除think作用域下面的值
Session::delete('name','think');</code></pre>
<p class="calibre10">指定作用域</p>
<pre class="calibre21"><code class="calibre22">// 指定当前作用域
Session::prefix('think');</code></pre>
<p class="calibre10">取值并删除</p>
<pre class="calibre21"><code class="calibre22">// 取值并删除
Session::pull('name');</code></pre>
<p class="calibre10">如果name的值不存在，返回<code class="calibre7">Null</code>。</p>
<p class="calibre10">清空</p>
<pre class="calibre21"><code class="calibre22">// 清除session（当前作用域）
Session::clear();
// 清除think作用域
Session::clear('think');</code></pre>
<p class="calibre10">下次请求之前有效（<code class="calibre7">v5.0.2+</code>）</p>
<pre class="calibre21"><code class="calibre22">// 设置session 并且在下一次请求之前有效
Session::flash('name','value');</code></pre>
<p class="calibre10">提前清除当前请求有效的数据（<code class="calibre7">v5.0.2+</code>）</p>
<pre class="calibre21"><code class="calibre22">// 清除当前请求有效的session
Session::flush();</code></pre>
<h2 id="%E4%BA%8C%E7%BA%A7%E6%95%B0%E7%BB%84" class="calibre15">二级数组</h2>
<p class="calibre10">支持session的二维数组操作，例如：</p>
<pre class="calibre21"><code class="calibre22">// 赋值（当前作用域）
Session::set('name.item','thinkphp');
// 判断（当前作用域）是否赋值
Session::has('name.item');
// 取值（当前作用域）
Session::get('name.item');
// 删除（当前作用域）
Session::delete('name.item');</code></pre>
<h2 id="%E5%8A%A9%E6%89%8B%E5%87%BD%E6%95%B0-9" class="calibre15">助手函数</h2>
<p class="calibre10">系统也提供了助手函数session完成相同的功能，例如：</p>
<pre class="calibre21"><code class="calibre22">// 初始化session
session([
    'prefix'     =&gt; 'module',
    'type'       =&gt; '',
    'auto_start' =&gt; true,
]);

// 赋值（当前作用域）
session('name', 'thinkphp');

// 赋值think作用域
session('name', 'thinkphp', 'think');

// 判断（当前作用域）是否赋值
session('?name');

// 取值（当前作用域）
session('name');

// 取值think作用域
session('name', '', 'think');

// 删除（当前作用域）
session('name', null);

// 清除session（当前作用域）
session(null);

// 清除think作用域
session(null, 'think');</code></pre>
<h2 id="session%E9%A9%B1%E5%8A%A8" class="calibre15">Session驱动</h2>
<p class="calibre10">支持指定 Session 驱动，配置文件如下：</p>
<pre class="calibre21"><code class="calibre22">'session' =&gt; [
    'prefix'     =&gt; 'module',
    'type'       =&gt; 'redis',
    'auto_start' =&gt; true,
     // redis主机
    'host'       =&gt; '127.0.0.1',
     // redis端口
    'port'       =&gt; 6379,
     // 密码
    'password'   =&gt; '',
]</code></pre>
<p class="calibre10">表示使用<code class="calibre7">redis</code>作为<code class="calibre7">session</code>类型。</p>
</div>
	
</body></html>
