<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-CN" xml:lang="zh-CN">
  <head>
    <title>关联统计</title>
    <meta content="IE=edge" http-equiv="X-UA-Compatible"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="page_styles.css" rel="stylesheet" type="text/css"/>
</head>
  <body class="calibre">
        <h1 class="book-title" id="calibre_toc_119">关联统计</h1>
<div class="book-content">
    <h2 id="%E5%85%B3%E8%81%94%E7%BB%9F%E8%AE%A1%EF%BC%88%60v5.0.5%2B%60%EF%BC%89" class="calibre15">关联统计（<code class="calibre7">V5.0.5+</code>）</h2>
<p class="calibre10">有些时候，并不需要获取关联数据，而只是希望获取关联数据的统计（关联统计仅针对一对多或者多对多的关联关系），这个时候可以使用<code class="calibre7">withCount</code>方法进行制定关联的统计。</p>
<pre class="calibre21"><code class="calibre22">$list = User::withCount('cards')-&gt;select([1,2,3]);
foreach($list as $user){
    // 获取用户关联的card关联统计
    echo $user-&gt;cards_count;
}</code></pre>
<p class="calibre10">关联统计功能会在模型的对象属性中自动添加一个以“关联方法名+<code class="calibre7">_count</code>”为名称的动态属性来保存相关的关联统计数据。</p>
<p class="calibre10">如果需要对关联统计进行条件过滤，可以使用</p>
<pre class="calibre21"><code class="calibre22">$list = User::withCount(['cards'=&gt;function($query){
    $query-&gt;where('status',1);
}])-&gt;select([1,2,3]);
foreach($list as $user){
    // 获取用户关联的card关联统计
    echo $user-&gt;cards_count;
}</code></pre>
<p class="calibre10">一对一关联关系使用关联统计是无效的，一般可以用exists查询来判断是否存在关联数据。</p>
</div>
	
</body></html>
