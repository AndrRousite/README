<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-CN" xml:lang="zh-CN">
  <head>
    <title>多语言</title>
    <meta content="IE=edge" http-equiv="X-UA-Compatible"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="page_styles.css" rel="stylesheet" type="text/css"/>
</head>
  <body class="calibre">
        <h1 class="book-title" id="calibre_toc_187">多语言</h1>
<div class="book-content">
    <p class="calibre10">ThinkPHP内置通过<code class="calibre7">\think\Lang</code>类提供多语言支持，如果你的应用涉及到国际化的支持，那么可以定义相关的语言包文件。任何字符串形式的输出，都可以定义语言常量。</p>
<h2 id="%E5%BC%80%E5%90%AF%E5%92%8C%E5%8A%A0%E8%BD%BD%E8%AF%AD%E8%A8%80%E5%8C%85" class="calibre15">开启和加载语言包</h2>
<p class="calibre10">默认情况下，系统载入的是配置的默认语言包，并且不会自动侦测当前系统的语言。<br class="calibre16"/>
默认语言由<code class="calibre7">default_lang</code>配置参数设置，系统默认设置为：</p>
<pre class="calibre21"><code class="calibre22">// 默认语言
'default_lang'           =&gt; 'zh-cn',</code></pre>
<p class="calibre10">要启用语言自动侦测和多语言自动切换，需要开启多语言切换，在应用的公共配置文件添加：</p>
<pre class="calibre21"><code class="calibre22">// 开启语言切换
'lang_switch_on' =&gt; true,   </code></pre>
<p class="calibre10">开启后，系统会自动检测当前语言（主要是指浏览器访问的情况下）会对两种情况进行检测：</p>
<ul class="calibre23"><li class="calibre20">是否有<code class="calibre7">$_GET['lang']</code></li>
<li class="calibre20">识别<code class="calibre7">$_SERVER['HTTP_ACCEPT_LANGUAGE']</code>中的第一个语言</li>
<li class="calibre20">检测到任何一种情况下采用Cookie缓存</li>
<li class="calibre20">如果检测到的语言在允许的语言列表内认为有效，否则使用默认设置的语言</li>
</ul><p class="calibre10">如果不希望浏览器自动侦测语言，请关闭<code class="calibre7">lang_switch_on</code>后设置默认语言。</p>
<p class="calibre10">如果在自动侦测语言的时候，希望设置允许的语言列表，不在列表范围的语言则仍然使用默认语言，可以使用：</p>
<pre class="calibre21"><code class="calibre22">// 设置允许的语言
Lang::setAllowLangList(['zh-cn','en-us']);</code></pre>
<h2 id="%E8%AF%AD%E8%A8%80%E5%8F%98%E9%87%8F%E5%AE%9A%E4%B9%89" class="calibre15">语言变量定义</h2>
<p class="calibre10">语言变量的定义，只需要在需要使用多语言的地方，写成：</p>
<pre class="calibre21"><code class="calibre22">Lang::get('add user error');
// 使用系统封装的助手函数
lang('add user error');</code></pre>
<p class="calibre10">也就是说，字符串信息要改成<code class="calibre7">Lang::get</code>方法来表示。</p>
<p class="calibre10">语言定义一般采用英语来描述。</p>
<h2 id="%E8%AF%AD%E8%A8%80%E6%96%87%E4%BB%B6%E5%AE%9A%E4%B9%89" class="calibre15">语言文件定义</h2>
<p class="calibre10">系统会默认加载下面三个语言包：</p>
<pre class="calibre21"><code class="calibre22">框架语言包: thinkphp\lang\当前语言.php
应用语言包: application\lang\当前语言.php
模块语言包: application\模块\lang\当前语言.php</code></pre>
<p class="calibre10">如果你还需要加载其他的语言包，可以在设置或者自动检测语言之后，用load方法进行加载：</p>
<pre class="calibre21"><code class="calibre22">Lang::load(APP_PATH . 'common\lang\zh-cn.php');</code></pre>
<p class="calibre10">ThinkPHP语言文件定义采用返回数组方式：</p>
<pre class="calibre21"><code class="calibre22">return [
     'hello thinkphp'  =&gt; '欢迎使用ThinkPHP',
     'data type error' =&gt; '数据类型错误',
];</code></pre>
<p class="calibre10">也可以在程序里面动态设置语言定义的值，使用下面的方式：</p>
<pre class="calibre21"><code class="calibre22">Lang::set('define2','语言定义');
$value = Lang::get('define2');</code></pre>
<p class="calibre10">通常多语言的使用是在控制器里面，但是模型类的自动验证功能里面会用到提示信息，这个部分也可以使用多语言的特性。例如原来的方式是把提示信息直接写在模型里面定义：</p>
<pre class="calibre21"><code class="calibre22">['title','require','标题必须！',1],</code></pre>
<p class="calibre10">如果使用了多语言功能的话（假设，我们在当前语言包里面定义了' lang_var'=&gt;'标题必须！'），就可以这样定义模型的自动验证</p>
<pre class="calibre21"><code class="calibre22">['title','require','{%lang_var}',1],</code></pre>
<p class="calibre10">如果要在模板中输出语言变量不需要在控制器中赋值，可以直接使用模板引擎特殊标签来直接输出语言定义的值：</p>
<pre class="calibre21"><code class="calibre22">{$Think.lang.lang_var}</code></pre>
<p class="calibre10">可以输出当前语言包里面定义的 <code class="calibre7">lang_var</code>语言定义。</p>
<h2 id="%E5%8F%98%E9%87%8F%E4%BC%A0%E5%85%A5%E6%94%AF%E6%8C%81" class="calibre15">变量传入支持</h2>
<p class="calibre10">语言包定义的时候支持传入变量，有两种方式</p>
<p class="calibre10">使用命名绑定方式，例如：</p>
<pre class="calibre21"><code class="calibre22">'file_format'    =&gt;    '文件格式: {:format},文件大小：{:size}',</code></pre>
<p class="calibre10">在模板中输出语言字符串的时候传入变量值即可：</p>
<pre class="calibre21"><code class="calibre22">{:lang('file_format',['format' =&gt; 'jpeg,png,gif,jpg','size' =&gt; '2MB'])}</code></pre>
<p class="calibre10">第二种方式是使用格式字串，如果你需要使用第三方的翻译工具，建议使用该方式定义变量。</p>
<pre class="calibre21"><code class="calibre22">'file_format'    =&gt;    '文件格式: %s,文件大小：%d',</code></pre>
<p class="calibre10">在模板中输出多语言的方式更改为：</p>
<pre class="calibre21"><code class="calibre22">{:lang('file_format',['jpeg,png,gif,jpg','2MB'])}</code></pre>
</div>
	
</body></html>
