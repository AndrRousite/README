<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-CN" xml:lang="zh-CN">
  <head>
    <title>事务操作</title>
    <meta content="IE=edge" http-equiv="X-UA-Compatible"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="page_styles.css" rel="stylesheet" type="text/css"/>
</head>
  <body class="calibre">
        <h1 class="book-title" id="calibre_toc_86">事务操作</h1>
<div class="book-content">
    <p class="calibre10">使用事务处理的话，需要数据库引擎支持事务处理。比如 MySQL 的 MyISAM 不支持事务处理，需要使用 InnoDB 引擎。</p>
<p class="calibre10">使用 transaction 方法操作数据库事务，当发生异常会自动回滚，例如：</p>
<p class="calibre10">自动控制事务处理</p>
<pre class="calibre21"><code class="calibre22">Db::transaction(function(){
    Db::table('think_user')-&gt;find(1);
    Db::table('think_user')-&gt;delete(1);
});</code></pre>
<p class="calibre10">也可以手动控制事务，例如：</p>
<pre class="calibre21"><code class="calibre22">// 启动事务
Db::startTrans();
try{
    Db::table('think_user')-&gt;find(1);
    Db::table('think_user')-&gt;delete(1);
    // 提交事务
    Db::commit();    
} catch (\Exception $e) {
    // 回滚事务
    Db::rollback();
}</code></pre>
<blockquote class="calibre5">
<p class="calibre14">注意在事务操作的时候，确保你的数据库连接是相同的。</p>
</blockquote>
</div>
	
</body></html>
