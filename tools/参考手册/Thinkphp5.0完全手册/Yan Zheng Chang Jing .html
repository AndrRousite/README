<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-CN" xml:lang="zh-CN">
  <head>
    <title>验证场景</title>
    <meta content="IE=edge" http-equiv="X-UA-Compatible"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="page_styles.css" rel="stylesheet" type="text/css"/>
</head>
  <body class="calibre">
        <h1 class="book-title" id="calibre_toc_172">验证场景</h1>
<div class="book-content">
    <h2 id="%E9%AA%8C%E8%AF%81%E5%9C%BA%E6%99%AF" class="calibre15">验证场景</h2>
<table class="calibre25"><thead class="calibre26"><tr class="calibre27"><th class="calibre28">版本</th>
<th class="calibre28">新增功能</th>
</tr></thead><tbody class="calibre29"><tr class="calibre27"><td class="pcalibre1 calibre30">5.0.4</td>
<td class="calibre34 pcalibre1">增加<code class="calibre7">hasScene</code>方法用于检查是否存在验证场景</td>
</tr></tbody></table><p class="calibre10">可以在定义验证规则的时候定义场景，并且验证不同场景的数据，例如：</p>
<pre class="calibre21"><code class="calibre22">$rule = [
    'name'  =&gt; 'require|max:25',
    'age'   =&gt; 'number|between:1,120',
    'email' =&gt; 'email',
];
$msg = [
    'name.require' =&gt; '名称必须',
    'name.max'     =&gt; '名称最多不能超过25个字符',
    'age.number'   =&gt; '年龄必须是数字',
    'age.between'  =&gt; '年龄只能在1-120之间',
    'email'        =&gt; '邮箱格式错误',
];
$data = [
    'name'  =&gt; 'thinkphp',
    'age'   =&gt; 10,
    'email' =&gt; 'thinkphp@qq.com',
];
$validate = new Validate($rule);
$validate-&gt;scene('edit', ['name', 'age']);
$result = $validate-&gt;scene('edit')-&gt;check($data);</code></pre>
<p class="calibre10">表示验证edit场景（该场景定义只需要验证name和age字段）。</p>
<p class="calibre10">如果使用了验证器，可以直接在类里面定义场景，例如：</p>
<pre class="calibre21"><code class="calibre22">namespace app\index\validate;

use think\Validate;

class User extends Validate
{
    protected $rule =   [
        'name'  =&gt; 'require|max:25',
        'age'   =&gt; 'number|between:1,120',
        'email' =&gt; 'email',    
    ];

    protected $message  =   [
        'name.require' =&gt; '名称必须',
        'name.max'     =&gt; '名称最多不能超过25个字符',
        'age.number'   =&gt; '年龄必须是数字',
        'age.between'  =&gt; '年龄只能在1-120之间',
        'email'        =&gt; '邮箱格式错误',    
    ];

    protected $scene = [
        'edit'  =&gt;  ['name','age'],
    ];

}</code></pre>
<p class="calibre10">然后再需要验证的地方直接使用 scene 方法验证</p>
<pre class="calibre21"><code class="calibre22">$data = [
    'name'  =&gt; 'thinkphp',
    'age'   =&gt; 10,
    'email' =&gt; 'thinkphp@qq.com',
];

$validate = new Validate($rule);
$result = $validate-&gt;scene('edit')-&gt;check($data);</code></pre>
<p class="calibre10">可以在定义场景的时候对某些字段的规则重新设置，例如：</p>
<pre class="calibre21"><code class="calibre22">namespace app\index\validate;

use think\Validate;

class User extends Validate
{
    protected $rule =   [
        'name'  =&gt; 'require|max:25',
        'age'   =&gt; 'number|between:1,120',
        'email' =&gt; 'email',    
    ];

    protected $message  =   [
        'name.require' =&gt; '名称必须',
        'name.max'     =&gt; '名称最多不能超过25个字符',
        'age.number'   =&gt; '年龄必须是数字',
        'age.between'  =&gt; '年龄只能在1-120之间',
        'email'        =&gt; '邮箱格式错误',    
    ];

    protected $scene = [
        'edit'  =&gt;  ['name','age'=&gt;'require|number|between:1,120'],
    ];

}</code></pre>
<p class="calibre10">可以对场景设置一个回调方法，用于动态设置要验证的字段，例如：</p>
<pre class="calibre21"><code class="calibre22">$rule = [
    'name'  =&gt; 'require|max:25',
    'age'   =&gt; 'number|between:1,120',
    'email' =&gt; 'email',
];
$msg = [
    'name.require' =&gt; '名称必须',
    'name.max'     =&gt; '名称最多不能超过25个字符',
    'age.number'   =&gt; '年龄必须是数字',
    'age.between'  =&gt; '年龄只能在1-120之间',
    'email'        =&gt; '邮箱格式错误',
];
$data = [
    'name'  =&gt; 'thinkphp',
    'age'   =&gt; 10,
    'email' =&gt; 'thinkphp@qq.com',
];
$validate = new Validate($rule);
$validate-&gt;scene('edit', function($key,$data){
    return 'email'==$key &amp;&amp; isset($data['id'])? true : false;
});
$result = $validate-&gt;scene('edit')-&gt;check($data);</code></pre>
</div>
	
</body></html>
