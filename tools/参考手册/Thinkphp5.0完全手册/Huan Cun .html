<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-CN" xml:lang="zh-CN">
  <head>
    <title>缓存</title>
    <meta content="IE=edge" http-equiv="X-UA-Compatible"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="page_styles.css" rel="stylesheet" type="text/css"/>
</head>
  <body class="calibre">
        <h1 class="book-title" id="calibre_toc_184">缓存</h1>
<div class="book-content">
    <h2 id="%E6%A6%82%E8%BF%B0-4" class="calibre15">概述</h2>
<p class="calibre10">ThinkPHP采用<code class="calibre7">think\Cache</code>类提供缓存功能支持。</p>
<table class="calibre25"><thead class="calibre26"><tr class="calibre27"><th class="calibre28">版本</th>
<th class="calibre28">新增功能</th>
</tr></thead><tbody class="calibre29"><tr class="calibre27"><td class="pcalibre1 calibre30">5.0.2</td>
<td class="calibre34 pcalibre1">增加<code class="calibre7">remember</code>方法</td>
</tr></tbody></table><h2 id="%E8%AE%BE%E7%BD%AE" class="calibre15">设置</h2>
<p class="calibre10">缓存支持采用驱动方式，所以缓存在使用之前，需要进行连接操作，也就是缓存初始化操作。</p>
<pre class="calibre21"><code class="calibre22">$options = [
    // 缓存类型为File
    'type'  =&gt;  'File', 
    // 缓存有效期为永久有效
    'expire'=&gt;  0, 
    //缓存前缀
    'prefix'=&gt;  'think'
     // 指定缓存目录
    'path'  =&gt;  APP_PATH.'runtime/cache/',
];
Cache::connect($options);</code></pre>
<p class="calibre10">或者通过定义配置参数的方式，在应用配置文件中添加：</p>
<pre class="calibre21"><code class="calibre22">'cache'  =&gt; [
    'type'   =&gt; 'File',
    'path'   =&gt; CACHE_PATH,
    'prefix' =&gt; '',
    'expire' =&gt; 0,
],</code></pre>
<p class="calibre10">支持的缓存类型包括file、memcache、wincache、sqlite、redis和xcache。</p>
<p class="calibre10">缓存参数根据不同的缓存方式会有所区别，通用的缓存参数如下：</p>
<table class="calibre25"><thead class="calibre26"><tr class="calibre27"><th class="calibre28">参数</th>
<th class="calibre28">描述</th>
</tr></thead><tbody class="calibre29"><tr class="calibre27"><td class="pcalibre1 calibre30">type</td>
<td class="calibre32 pcalibre1">缓存类型</td>
</tr><tr class="calibre27"><td class="pcalibre1 calibre31">expire</td>
<td class="pcalibre1 calibre31">缓存有效期 （默认为0 表示永久缓存）</td>
</tr><tr class="calibre27"><td class="pcalibre1 calibre31">prefix</td>
<td class="calibre33 pcalibre1">缓存前缀（默认为空）</td>
</tr></tbody></table><h2 id="%E4%BD%BF%E7%94%A8" class="calibre15">使用</h2>
<p class="calibre10">缓存初始化之后，就可以进行相关缓存操作了。</p>
<blockquote class="calibre5">
<p class="calibre14">如果通过配置文件方式定义缓存参数的话，可以无需手动进行缓存初始化操作，可以直接进行缓存读取和设置等操作。</p>
</blockquote>
<h3 id="%E8%AE%BE%E7%BD%AE%E7%BC%93%E5%AD%98" class="calibre17">设置缓存</h3>
<p class="calibre10">设置缓存有效期</p>
<pre class="calibre21"><code class="calibre22">Cache::set('name',$value,3600);</code></pre>
<p class="calibre10">如果设置成功返回true，否则返回false。</p>
<h3 id="%E7%BC%93%E5%AD%98%E8%87%AA%E5%A2%9E" class="calibre17">缓存自增</h3>
<p class="calibre10">针对数值类型的缓存数据，可以使用自增操作，例如：</p>
<pre class="calibre21"><code class="calibre22">// name自增（步进值为1）
Cache::inc('name');
// name自增（步进值为3）
Cache::inc('name',3);</code></pre>
<h3 id="%E7%BC%93%E5%AD%98%E8%87%AA%E5%87%8F" class="calibre17">缓存自减</h3>
<p class="calibre10">针对数值类型的缓存数据，可以使用自减操作，例如：</p>
<pre class="calibre21"><code class="calibre22">// name自减（步进值为1）
Cache::dec('name');
// name自减（步进值为3）
Cache::dec('name',3);</code></pre>
<h3 id="%E8%8E%B7%E5%8F%96%E7%BC%93%E5%AD%98" class="calibre17">获取缓存</h3>
<p class="calibre10">获取缓存数据可以使用：</p>
<pre class="calibre21"><code class="calibre22">dump(Cache::get('name')); </code></pre>
<p class="calibre10">如果<code class="calibre7">name</code>值不存在，则默认返回 <code class="calibre7">false</code>。</p>
<p class="calibre10">支持指定默认值，例如：</p>
<pre class="calibre21"><code class="calibre22">dump(Cache::get('name','')); </code></pre>
<p class="calibre10">表示如果<code class="calibre7">name</code>值不存在，则返回空字符串。</p>
<h3 id="%E5%88%A0%E9%99%A4%E7%BC%93%E5%AD%98" class="calibre17">删除缓存</h3>
<pre class="calibre21"><code class="calibre22">Cache::rm('name'); </code></pre>
<h3 id="%E8%8E%B7%E5%8F%96%E5%B9%B6%E5%88%A0%E9%99%A4%E7%BC%93%E5%AD%98" class="calibre17">获取并删除缓存</h3>
<pre class="calibre21"><code class="calibre22">Cache::pull('name'); </code></pre>
<p class="calibre10">如果<code class="calibre7">name</code>值不存在，则返回<code class="calibre7">null</code>。</p>
<h3 id="%E6%B8%85%E7%A9%BA%E7%BC%93%E5%AD%98" class="calibre17">清空缓存</h3>
<pre class="calibre21"><code class="calibre22">Cache::clear(); </code></pre>
<h3 id="%E4%B8%8D%E5%AD%98%E5%9C%A8%E5%88%99%E5%86%99%E5%85%A5%E7%BC%93%E5%AD%98%E6%95%B0%E6%8D%AE%E5%90%8E%E8%BF%94%E5%9B%9E%EF%BC%88%60v5.0.2%2B%60%EF%BC%89" class="calibre17">不存在则写入缓存数据后返回（<code class="calibre7">v5.0.2+</code>）</h3>
<pre class="calibre21"><code class="calibre22">Cache::remember('name',function(){
    return time();
});</code></pre>
<h3 id="%E5%8A%A9%E6%89%8B%E5%87%BD%E6%95%B0-8" class="calibre17">助手函数</h3>
<p class="calibre10">系统对缓存操作提供了助手函数<code class="calibre7">cache</code>，用法如下：</p>
<pre class="calibre21"><code class="calibre22">$options = [
     // 缓存类型为File
    'type'   =&gt; 'File', 
     // 缓存有效期为永久有效
    'expire' =&gt; 0,
     // 指定缓存目录
    'path'   =&gt; APP_PATH . 'runtime/cache/', 
];

// 缓存初始化
// 不进行缓存初始化的话，默认使用配置文件中的缓存配置
cache($options);

// 设置缓存数据
cache('name', $value, 3600);
// 获取缓存数据
var_dump(cache('name'));
// 删除缓存数据
cache('name', NULL);

// 设置缓存的同时并且进行参数设置
cache('test', $value, $options); </code></pre>
<h2 id="%E7%BC%93%E5%AD%98%E6%A0%87%E7%AD%BE" class="calibre15">缓存标签</h2>
<p class="calibre10">支持给缓存数据打标签，例如：</p>
<pre class="calibre21"><code class="calibre22">Cache::tag('tag')-&gt;set('name1','value1');
Cache::tag('tag')-&gt;set('name2','value2');
// 或者批量设置缓存标签
Cache::set('name1','value1');
Cache::set('name2','value2');
Cache::tag('tag',['name1','name2']);
// 清除tag标签的缓存数据
Cache::clear('tag');</code></pre>
<h2 id="%E5%90%8C%E6%97%B6%E4%BD%BF%E7%94%A8%E5%A4%9A%E4%B8%AA%E7%BC%93%E5%AD%98%E7%B1%BB%E5%9E%8B" class="calibre15">同时使用多个缓存类型</h2>
<p class="calibre10">如果要同时使用多个缓存类型进行操作的话，可以做如下配置：</p>
<pre class="calibre21"><code class="calibre22">'cache' =&gt;  [
    // 使用复合缓存类型
    'type'  =&gt;  'complex',
    // 默认使用的缓存
    'default'   =&gt;  [
        // 驱动方式
        'type'   =&gt; 'File',
        // 缓存保存目录
        'path'   =&gt; CACHE_PATH,
    ],
    // 文件缓存
    'file'   =&gt;  [
        // 驱动方式
        'type'   =&gt; 'file',
        // 设置不同的缓存保存目录
        'path'   =&gt; RUNTIME_PATH . 'file/',
    ],  
    // redis缓存
    'redis'   =&gt;  [
        // 驱动方式
        'type'   =&gt; 'redis',
        // 服务器地址
        'host'       =&gt; '127.0.0.1',
    ],     
],</code></pre>
<p class="calibre10"><code class="calibre7">cache.type</code>配置为complex之后，就可以缓存多个缓存类型和缓存配置，每个缓存配置的方法和之前一样，并且你可以给相同类型的缓存类型（使用不同的缓存标识）配置不同的缓存配置参数。</p>
<p class="calibre10">当使用</p>
<pre class="calibre21"><code class="calibre22">Cache::set('name', 'value');
Cache::get('name');</code></pre>
<p class="calibre10">的时候，其实使用的是<code class="calibre7">default</code>缓存标识的缓存配置，如果需要切换到其它的缓存标识操作，可以使用：</p>
<pre class="calibre21"><code class="calibre22">// 切换到file操作
Cache::store('file')-&gt;set('name','value');
Cache::get('name');
// 切换到redis操作
Cache::store('redis')-&gt;set('name','value');
Cache::get('name');</code></pre>
</div>
	
</body></html>
