<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-CN" xml:lang="zh-CN">
  <head>
    <title>数据完成</title>
    <meta content="IE=edge" http-equiv="X-UA-Compatible"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="page_styles.css" rel="stylesheet" type="text/css"/>
</head>
  <body class="calibre">
        <h1 class="book-title" id="calibre_toc_105">数据完成</h1>
<div class="book-content">
    <p class="calibre10">数据自动完成指在不需要手动赋值的情况下对字段的值进行处理后写入数据库。</p>
<p class="calibre10">系统支持<code class="calibre7">auto</code>、<code class="calibre7">insert</code>和<code class="calibre7">update</code>三个属性，可以分别在写入、新增和更新的时候进行字段的自动完成机制，auto属性自动完成包含新增和更新操作，例如我们定义<code class="calibre7">User</code>模型类如下：</p>
<pre class="calibre21"><code class="calibre22">namespace app\index\model;

use think\Model;

class User extends Model
{
    protected $auto = ['name', 'ip'];
    protected $insert = ['status' =&gt; 1];  
    protected $update = [];  

    protected function setNameAttr($value)
    {
        return strtolower($value);
    }

    protected function setIpAttr()
    {
        return request()-&gt;ip();
    }
}</code></pre>
<p class="calibre10">在新增数据的时候，会对<code class="calibre7">name</code>、<code class="calibre7">ip</code>和 <code class="calibre7">status</code> 字段自动完成或者处理。</p>
<pre class="calibre21"><code class="calibre22">$user = new User;
$user-&gt;name = 'ThinkPHP';
$user-&gt;save();
echo $user-&gt;name; // thinkphp
echo $user-&gt;status; // 1</code></pre>
<p class="calibre10">在保存操作的时候，会自动处理<code class="calibre7">name</code>字段的值及完成<code class="calibre7">ip</code>字段的赋值。</p>
<pre class="calibre21"><code class="calibre22">$user = User::find(1);
$user-&gt;name = 'THINKPHP';
$user-&gt;save();
echo $user-&gt;name; // thinkphp
echo $user-&gt;ip; // 127.0.0.1</code></pre>
<blockquote class="info">
<p class="calibre14">开发者需要理清“修改器”与“自动完成”的关系。</p>
</blockquote>
</div>
	
</body></html>
