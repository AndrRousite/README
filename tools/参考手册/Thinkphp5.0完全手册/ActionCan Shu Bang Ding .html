<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-CN" xml:lang="zh-CN">
  <head>
    <title>参数绑定</title>
    <meta content="IE=edge" http-equiv="X-UA-Compatible"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="page_styles.css" rel="stylesheet" type="text/css"/>
</head>
  <body class="calibre">
        <h1 class="book-title" id="calibre_toc_65">参数绑定</h1>
<div class="book-content">
    <p class="calibre10">方法参数绑定是把URL地址（或者路由地址）中的变量作为操作方法的参数直接传入。</p>
<h2 id="%E6%93%8D%E4%BD%9C%E6%96%B9%E6%B3%95%E5%8F%82%E6%95%B0%E7%BB%91%E5%AE%9A" class="calibre15">操作方法参数绑定</h2>
<h3 id="%E6%8C%89%E5%90%8D%E7%A7%B0%E7%BB%91%E5%AE%9A" class="calibre17">按名称绑定</h3>
<p class="calibre10">参数绑定方式默认是按照变量名进行绑定，例如，我们给Blog控制器定义了两个操作方法<code class="calibre7">read</code>和<code class="calibre7">archive</code>方法，由于<code class="calibre7">read</code>操作需要指定一个<code class="calibre7">id</code>参数，<code class="calibre7">archive</code>方法需要指定年份（<code class="calibre7">year</code>）和月份（<code class="calibre7">month</code>）两个参数，那么我们可以如下定义：</p>
<pre class="calibre21"><code class="calibre22">namespace app\index\Controller;

class Blog 
{
    public function read($id)
    {
        return 'id='.$id;
    }

    public function archive($year='2016',$month='01')
    {
        return 'year='.$year.'&amp;month='.$month;
    }
}</code></pre>
<blockquote class="calibre5">
<p class="calibre14">注意这里的操作方法并没有具体的业务逻辑，只是简单的示范。</p>
</blockquote>
<p class="calibre10">URL的访问地址分别是：</p>
<pre class="calibre21"><code class="calibre22">http://serverName/index.php/index/blog/read/id/5
http://serverName/index.php/index/blog/archive/year/2016/month/06</code></pre>
<p class="calibre10">两个URL地址中的<code class="calibre7">id</code>参数和<code class="calibre7">year</code>和<code class="calibre7">month</code>参数会自动和<code class="calibre7">read</code>操作方法以及<code class="calibre7">archive</code>操作方法的<code class="calibre7">同名参数</code>绑定。</p>
<blockquote class="calibre5">
<p class="calibre14">变量名绑定不一定由访问URL决定，路由地址也能起到相同的作用</p>
</blockquote>
<p class="calibre10">输出的结果依次是：</p>
<pre class="calibre21"><code class="calibre22">id=5
year=2016&amp;month=06</code></pre>
<p class="calibre10">按照变量名进行参数绑定的参数必须和URL中传入的变量名称一致，但是参数顺序不需要一致。也就是说</p>
<pre class="calibre21"><code class="calibre22">http://serverName/index.php/index/blog/archive/month/06/year/2016</code></pre>
<p class="calibre10">和上面的访问结果是一致的，URL中的参数顺序和操作方法中的参数顺序都可以随意调整，关键是确保参数名称一致即可。</p>
<p class="calibre10">如果用户访问的URL地址是（至于为什么会这么访问暂且不提）：</p>
<pre class="calibre21"><code class="calibre22">http://serverName/index.php/index/blog/read/</code></pre>
<p class="calibre10">那么会抛出下面的异常提示： <code class="calibre7">参数错误:id</code></p>
<p class="calibre10">报错的原因很简单，因为在执行read操作方法的时候，id参数是必须传入参数的，但是方法无法从URL地址中获取正确的id参数信息。由于我们不能相信用户的任何输入，因此建议你给read方法的id参数添加默认值，例如：</p>
<pre class="calibre21"><code class="calibre22">    public function read($id=0)
    {
        return 'id='.$id;
    }</code></pre>
<p class="calibre10">这样，当我们访问 <code class="calibre7">http://serverName/index.php/index/blog/read/</code> 的时候 就会输出</p>
<pre class="calibre21"><code class="calibre22">id=0</code></pre>
<blockquote class="calibre5">
<p class="calibre14">始终给操作方法的参数定义默认值是一个避免报错的好办法</p>
</blockquote>
<h3 id="%E6%8C%89%E9%A1%BA%E5%BA%8F%E7%BB%91%E5%AE%9A" class="calibre17">按顺序绑定</h3>
<p class="calibre10">还可以支持按照URL的参数顺序进行绑定的方式，合理规划URL参数的顺序绑定对简化URL地址可以起到一定的帮助。</p>
<p class="calibre10">还是上面的例子，控制器不变，还是使用：</p>
<pre class="calibre21"><code class="calibre22">namespace app\index\Controller;

class Blog 
{
    public function read($id)
    {
        return 'id='.$id;
    }

    public function archive($year='2016',$month='01')
    {
        return 'year='.$year.'&amp;month='.$month;
    }
}</code></pre>
<p class="calibre10">我们在配置文件中添加配置参数如下：</p>
<pre class="calibre21"><code class="calibre22">// URL参数方式改成顺序解析
'url_param_type'         =&gt; 1,</code></pre>
<p class="calibre10">接下来，访问下面的URL地址：</p>
<pre class="calibre21"><code class="calibre22">http://serverName/index.php/index/blog/read/5
http://serverName/index.php/index/blog/archive/2016/06</code></pre>
<p class="calibre10">输出的结果依次是：</p>
<pre class="calibre21"><code class="calibre22">id=5
year=2016&amp;month=06</code></pre>
<p class="calibre10">按参数顺序绑定的话，参数的顺序不能随意调整，如果访问：</p>
<pre class="calibre21"><code class="calibre22">http://serverName/index.php/index/blog/archive/06/2016</code></pre>
<p class="calibre10">最后的输出结果则变成：</p>
<pre class="calibre21"><code class="calibre22">id=5
year=06&amp;month=2016</code></pre>
<blockquote class="danger">
<h4 id="%E6%B3%A8%E6%84%8F" class="calibre6">注意</h4>
<hr class="calibre8"/><p class="calibre14">按顺序绑定参数的话，操作方法的参数只能使用URL pathinfo变量，而不能使用get或者post变量。</p>
</blockquote>
<p class="calibre10">参数绑定有一个特例，如果你的操作方法中定义有<code class="calibre7">Request</code>对象作为参数的话，无论参数位置在哪里，都会自动注入，而不需要进行参数绑定。</p>
<h2 id="%E6%9E%B6%E6%9E%84%E6%96%B9%E6%B3%95%E5%8F%82%E6%95%B0%E7%BB%91%E5%AE%9A%EF%BC%88v5.0.1%EF%BC%89" class="calibre15">架构方法参数绑定（V5.0.1）</h2>
<p class="calibre10">可以对架构函数进行参数绑定，当前请求的路由变量可以自动绑定到架构函数的参数，例如：</p>
<pre class="calibre21"><code class="calibre22">namespace app\index\Controller;

class Blog 
{
    protected $name;
    public function __construct($name = null)
    {
        $this-&gt;name = $name;
    }
}</code></pre>
<p class="calibre10">如果访问</p>
<pre class="calibre21"><code class="calibre22">http://localhost/index/index/index/name/thinkphp</code></pre>
<p class="calibre10">当前请求的路由变量name的值thinkphp会自动传入架构方法的name变量。</p>
</div>
	
</body></html>
