<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-CN" xml:lang="zh-CN">
  <head>
    <title>高级查询</title>
    <meta content="IE=edge" http-equiv="X-UA-Compatible"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="page_styles.css" rel="stylesheet" type="text/css"/>
</head>
  <body class="calibre">
        <h1 class="book-title" id="calibre_toc_81">高级查询</h1>
<div class="book-content">
    <h2 id="%E5%BF%AB%E6%8D%B7%E6%9F%A5%E8%AF%A2" class="calibre15">快捷查询</h2>
<p class="calibre10">快捷查询方式是<strong class="calibre12">一种多字段相同查询条件</strong>的简化写法，可以进一步简化查询条件的写法，在多个字段之间用<code class="calibre7">|</code>分割表示OR查询，用<code class="calibre7">&amp;</code>分割表示AND查询，可以实现下面的查询，例如：</p>
<pre class="calibre21"><code class="calibre22">Db::table('think_user')
    -&gt;where('name|title','like','thinkphp%')
    -&gt;where('create_time&amp;update_time','&gt;',0)
    -&gt;find();</code></pre>
<p class="calibre10">生成的查询SQL是：</p>
<pre class="calibre21"><code class="calibre22">SELECT * FROM `think_user` WHERE ( `name` LIKE 'thinkphp%' OR `title` LIKE 'thinkphp%' ) AND ( `create_time` &gt; 0 AND `update_time` &gt; 0 ) LIMIT 1</code></pre>
<blockquote class="calibre5">
<p class="calibre14">快捷查询支持所有的查询表达式。</p>
</blockquote>
<h2 id="%E5%8C%BA%E9%97%B4%E6%9F%A5%E8%AF%A2" class="calibre15">区间查询</h2>
<p class="calibre10">区间查询是一种<strong class="calibre12">同一字段多个查询条件</strong>的简化写法，例如：</p>
<pre class="calibre21"><code class="calibre22">Db::table('think_user')
    -&gt;where('name',['like','thinkphp%'],['like','%thinkphp'])
    -&gt;where('id',['&gt;',0],['&lt;&gt;',10],'or')
    -&gt;find();</code></pre>
<p class="calibre10">生成的SQL语句为：</p>
<pre class="calibre21"><code class="calibre22">SELECT * FROM `think_user` WHERE ( `name` LIKE 'thinkphp%' AND `name` LIKE '%thinkphp' ) AND ( `id` &gt; 0 OR `id` &lt;&gt; 10 ) LIMIT 1</code></pre>
<blockquote class="calibre5">
<p class="calibre14">区间查询的查询条件必须使用数组定义方式，支持所有的查询表达式。</p>
</blockquote>
<p class="calibre10">下面的查询方式是错误的：</p>
<pre class="calibre21"><code class="calibre22">Db::table('think_user')
    -&gt;where('name',['like','thinkphp%'],['like','%thinkphp'])
    -&gt;where('id',5,['&lt;&gt;',10],'or')
    -&gt;find();</code></pre>
<h2 id="%E6%89%B9%E9%87%8F%E6%9F%A5%E8%AF%A2" class="calibre15">批量查询</h2>
<p class="calibre10">可以进行多个条件的批量条件查询定义，例如：</p>
<pre class="calibre21"><code class="calibre22">Db::table('think_user')
    -&gt;where([
        'name'  =&gt;  ['like','thinkphp%'],
        'title' =&gt;  ['like','%thinkphp'],
        'id'    =&gt;  ['&gt;',0],
        'status'=&gt;  1
    ])
    -&gt;select();</code></pre>
<p class="calibre10">生成的SQL语句为：</p>
<pre class="calibre21"><code class="calibre22">SELECT * FROM `think_user` WHERE `name` LIKE 'thinkphp%' AND `title` LIKE '%thinkphp' AND `id` &gt; 0 AND `status` = '1'</code></pre>
<h2 id="%E9%97%AD%E5%8C%85%E6%9F%A5%E8%AF%A2" class="calibre15">闭包查询</h2>
<pre class="calibre21"><code class="calibre22">Db::table('think_user')-&gt;select(function($query){
    $query-&gt;where('name','thinkphp')
        -&gt;whereOr('id','&gt;',10);
});</code></pre>
<p class="calibre10">生成的SQL语句为：</p>
<pre class="calibre21"><code class="calibre22">SELECT * FROM `think_user` WHERE `name` = 'thinkphp' OR `id` &gt; 10</code></pre>
<h2 id="%E4%BD%BF%E7%94%A8query%E5%AF%B9%E8%B1%A1%E6%9F%A5%E8%AF%A2" class="calibre15">使用Query对象查询</h2>
<p class="calibre10">也可以事先封装Query对象，并传入select方法，例如：</p>
<pre class="calibre21"><code class="calibre22">$query = new \think\db\Query;
$query-&gt;name('user')
    -&gt;where('name','like','%think%')
    -&gt;where('id','&gt;',10)
    -&gt;limit(10);
Db::select($query);    </code></pre>
<blockquote class="calibre5">
<p class="calibre14">如果使用<code class="calibre7">Query</code>对象的话，<code class="calibre7">select</code>方法之前调用的任何的链式操作都是无效。</p>
</blockquote>
<h2 id="%E6%B7%B7%E5%90%88%E6%9F%A5%E8%AF%A2-1" class="calibre15">混合查询</h2>
<p class="calibre10">可以结合前面提到的所有方式进行混合查询，例如：</p>
<pre class="calibre21"><code class="calibre22">Db::table('think_user')
    -&gt;where('name',['like','thinkphp%'],['like','%thinkphp'])
    -&gt;where(function($query){
        $query-&gt;where('id',['&lt;',10],['&gt;',100],'or');
    })
    -&gt;select();</code></pre>
<p class="calibre10">生成的SQL语句是：</p>
<pre class="calibre21"><code class="calibre22">SELECT * FROM `think_user` WHERE ( `name` LIKE 'thinkphp%' AND `name` LIKE '%thinkphp' ) AND ( `id` &lt; 10 or `id` &gt; 100 )</code></pre>
<h2 id="%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2" class="calibre15">字符串条件查询</h2>
<p class="calibre10">对于一些实在复杂的查询，也可以直接使用原生SQL语句进行查询，例如：</p>
<pre class="calibre21"><code class="calibre22">Db::table('think_user')
    -&gt;where('id &gt; 0 AND name LIKE "thinkphp%"')
    -&gt;select();</code></pre>
<p class="calibre10">为了安全起见，我们可以对字符串查询条件使用参数绑定，例如：</p>
<pre class="calibre21"><code class="calibre22">Db::table('think_user')
    -&gt;where('id &gt; :id AND name LIKE :name ',['id'=&gt;0, 'name'=&gt;'thinkphp%'])
    -&gt;select();</code></pre>
<p class="calibre10"><code class="calibre7">V5.0.4+</code>开始，ThinkPHP支持对同一个字段多次调用查询条件，例如：</p>
<pre class="calibre21"><code class="calibre22">Db::table('think_user')
    -&gt;where('name','like','%think%')
    -&gt;where('name','like','%php%')
    -&gt;where('id','in',[1,5,80,50])
    -&gt;where('id','&gt;',10)
    -&gt;find();</code></pre>
<h2 id="%E5%BF%AB%E6%8D%B7%E6%96%B9%E6%B3%95%EF%BC%88%60v5.0.5%2B%60%EF%BC%89" class="calibre15">快捷方法（<code class="calibre7">V5.0.5+</code>）</h2>
<p class="calibre10"><code class="calibre7">V5.0.5+</code>版本开始新增了一系列快捷方法，用于简化查询，包括：</p>
<table class="calibre25"><thead class="calibre26"><tr class="calibre27"><th class="calibre28">方法</th>
<th class="calibre28">作用</th>
</tr></thead><tbody class="calibre29"><tr class="calibre27"><td class="pcalibre1 calibre30"><code class="calibre7">whereNull</code></td>
<td class="calibre32 pcalibre1">查询字段是否为Null</td>
</tr><tr class="calibre27"><td class="pcalibre1 calibre31"><code class="calibre7">whereNotNull</code></td>
<td class="pcalibre1 calibre31">查询字段是否不为Null</td>
</tr><tr class="calibre27"><td class="pcalibre1 calibre31"><code class="calibre7">whereIn</code></td>
<td class="pcalibre1 calibre31">字段IN查询</td>
</tr><tr class="calibre27"><td class="pcalibre1 calibre31"><code class="calibre7">whereNotIn</code></td>
<td class="pcalibre1 calibre31">字段NOT IN查询</td>
</tr><tr class="calibre27"><td class="pcalibre1 calibre31"><code class="calibre7">whereBetween</code></td>
<td class="pcalibre1 calibre31">字段BETWEEN查询</td>
</tr><tr class="calibre27"><td class="pcalibre1 calibre31"><code class="calibre7">whereNotBetween</code></td>
<td class="pcalibre1 calibre31">字段NOT BETWEEN查询</td>
</tr><tr class="calibre27"><td class="pcalibre1 calibre31"><code class="calibre7">whereLike</code></td>
<td class="pcalibre1 calibre31">字段LIKE查询</td>
</tr><tr class="calibre27"><td class="pcalibre1 calibre31"><code class="calibre7">whereNotLike</code></td>
<td class="pcalibre1 calibre31">字段NOT LIKE查询</td>
</tr><tr class="calibre27"><td class="pcalibre1 calibre31"><code class="calibre7">whereExists</code></td>
<td class="pcalibre1 calibre31">EXISTS条件查询</td>
</tr><tr class="calibre27"><td class="pcalibre1 calibre31"><code class="calibre7">whereNotExists</code></td>
<td class="pcalibre1 calibre31">NOT EXISTS条件查询</td>
</tr><tr class="calibre27"><td class="pcalibre1 calibre31"><code class="calibre7">whereExp</code></td>
<td class="calibre33 pcalibre1">表达式查询</td>
</tr></tbody></table></div>
	
</body></html>
