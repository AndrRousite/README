<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-CN" xml:lang="zh-CN">
  <head>
    <title>视图查询</title>
    <meta content="IE=edge" http-equiv="X-UA-Compatible"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="page_styles.css" rel="stylesheet" type="text/css"/>
</head>
  <body class="calibre">
        <h1 class="book-title" id="calibre_toc_82">视图查询</h1>
<div class="book-content">
    <p class="calibre10">视图查询可以实现不依赖数据库视图的多表查询，并不需要数据库支持视图，例如：</p>
<pre class="calibre21"><code class="calibre22">Db::view('User','id,name')
    -&gt;view('Profile','truename,phone,email','Profile.user_id=User.id')
    -&gt;view('Score','score','Score.user_id=Profile.id')
    -&gt;where('score','&gt;',80)
    -&gt;select();</code></pre>
<p class="calibre10">生成的SQL语句类似于：</p>
<pre class="calibre21"><code class="calibre22">SELECT User.id,User.name,Profile.truename,Profile.phone,Profile.email,Score.score FROM think_user User INNER JOIN think_profile Profile ON Profile.user_id=User.id INNER JOIN think_socre Score ON Score.user_id=Profile.id WHERE Score.score &gt; 80</code></pre>
<blockquote class="calibre5">
<p class="calibre14">注意，视图查询无需调用<code class="calibre7">table</code>和<code class="calibre7">join</code>方法，并且在调用<code class="calibre7">where</code>和<code class="calibre7">order</code>方法的时候只需要使用字段名而不需要加表名。</p>
</blockquote>
<p class="calibre10">默认使用INNER join查询，如果需要更改，可以使用：</p>
<pre class="calibre21"><code class="calibre22">Db::view('User','id,name')
    -&gt;view('Profile','truename,phone,email','Profile.user_id=User.id','LEFT')
    -&gt;view('Score','score','Score.user_id=Profile.id','RIGHT')
    -&gt;where('score','&gt;',80)
    -&gt;select();</code></pre>
<p class="calibre10">生成的SQL语句类似于：</p>
<pre class="calibre21"><code class="calibre22">SELECT User.id,User.name,Profile.truename,Profile.phone,Profile.email,Score.score FROM think_user User LEFT JOIN think_profile Profile ON Profile.user_id=User.id RIGHT JOIN think_socre Score ON Score.user_id=Profile.id WHERE Score.score &gt; 80</code></pre>
<p class="calibre10">可以使用别名：</p>
<pre class="calibre21"><code class="calibre22">Db::view('User',['id'=&gt;'uid','name'=&gt;'account'])
    -&gt;view('Profile','truename,phone,email','Profile.user_id=User.id')
    -&gt;view('Score','score','Score.user_id=Profile.id')
    -&gt;where('score','&gt;',80)
    -&gt;select();</code></pre>
<p class="calibre10">生成的SQL语句变成：</p>
<pre class="calibre21"><code class="calibre22">SELECT User.id AS uid,User.name AS account,Profile.truename,Profile.phone,Profile.email,Score.score FROM think_user User INNER JOIN think_profile Profile ON Profile.user_id=User.id INNER JOIN think_socre Score ON Score.user_id=Profile.id WHERE Score.score &gt; 80</code></pre>
<p class="calibre10">可以使用数组的方式定义表名以及别名，例如：</p>
<pre class="calibre21"><code class="calibre22">Db::view(['think_user'=&gt;'member'],['id'=&gt;'uid','name'=&gt;'account'])
    -&gt;view('Profile','truename,phone,email','Profile.user_id=member.id')
    -&gt;view('Score','score','Score.user_id=Profile.id')
    -&gt;where('score','&gt;',80)
    -&gt;select();</code></pre>
<p class="calibre10">生成的SQL语句变成：</p>
<pre class="calibre21"><code class="calibre22">SELECT member.id AS uid,member.name AS account,Profile.truename,Profile.phone,Profile.email,Score.score FROM think_user member INNER JOIN think_profile Profile ON Profile.user_id=member.id INNER JOIN think_socre Score ON Score.user_id=Profile.id WHERE Score.score &gt; 80</code></pre>
</div>
	
</body></html>
